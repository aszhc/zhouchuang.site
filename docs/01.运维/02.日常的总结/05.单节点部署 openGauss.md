---
title: å•èŠ‚ç‚¹éƒ¨ç½² openGauss
date: 2025-10-16 09:50:14
permalink: /pages/41783c/
categories:
  - è¿ç»´
  - æ—¥å¸¸çš„æ€»ç»“
tags:
  - æ•°æ®åº“
  - openGauss
  - é«˜æ–¯æ•°æ®åº“
  - éƒ¨ç½²
author: 
  name: ZhouChuang
  link: https://github.com/aszhc
---

æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä»é›¶éƒ¨ç½²ä¸€ä¸ªå•èŠ‚ç‚¹çš„ openGauss æ•°æ®åº“ã€‚

<!-- more -->

::: tip

**ç¯å¢ƒ**ï¼š

æ“ä½œç³»ç»Ÿï¼šCentOS 7.9-X86_64

openGauss ç‰ˆæœ¬ï¼š6.0.2 (LTS)

:::

## 1 å®‰è£…å‰å‡†å¤‡

### 1.1 è·å–å®‰è£…åŒ…

1. ä»openGausså¼€æºç¤¾åŒºä¸‹è½½å¯¹åº”å¹³å°çš„å®‰è£…åŒ…
   1. ç™»å½•[openGausså¼€æºç¤¾åŒº](https://opengauss.org/zh/download/)ï¼Œé€‰æ‹©å¯¹åº”å¹³å°çš„æœ€æ–°å®‰è£…åŒ…ä¸‹è½½ã€‚å¯¹äºä¸ªäººå¼€å‘è€…æˆ–éä¼ä¸šçº§ç¯å¢ƒï¼Œä¸‹è½½æç®€å®‰è£…åŒ…ï¼ˆä¸å®‰è£…OMç­‰ç»„ä»¶ï¼‰å³å¯ã€‚
   2. é€‰æ‹©å¯¹åº”çš„ç³»ç»Ÿå’Œæ¶æ„ï¼Œâ€œä¸‹è½½â€ã€‚

### 1.2 åˆ›å»ºç”¨æˆ·å’Œç”¨æˆ·ç»„

æ ¹æ®**æƒé™éš”ç¦»**åŸåˆ™ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·ã€‚

1. åˆ›å»ºç”¨æˆ·ç»„dbgroupã€‚

   ```bash
   groupadd dbgroup
   ```

2. åˆ›å»ºç”¨æˆ·ç»„dbgroupä¸‹çš„æ™®é€šç”¨æˆ·ommï¼Œå¹¶è®¾ç½®æ™®é€šç”¨æˆ·ommçš„å¯†ç ï¼Œå¯†ç å»ºè®®è®¾ç½®ä¸ºomm@123ã€‚

   ```bash
   useradd -g dbgroup omm
   passwd omm
   ```

3. ä½¿ç”¨ommç”¨æˆ·ç™»å½•åˆ°openGaussåŒ…å®‰è£…çš„ä¸»æœºï¼Œè§£å‹openGausså‹ç¼©åŒ…åˆ°å®‰è£…ç›®å½•ã€‚

   ```bash
   # 1. ç”±äº omm ä¸å…·æœ‰ sudo æƒé™ï¼Œæˆ‘ä»¬å…ˆè®© root ç”¨æˆ·åˆ›å»ºæ•°æ®åº“ç›®å½•
   mkdir -p /utxt/soft/openGauss
   chown -R omm:dbgroup /utxt/soft/openGauss
   chmod -R 755 /utxt/soft/openGauss/
   
   # 2. åˆ‡å› omm ç”¨æˆ·ï¼Œæ‰§è¡Œ
   [omm@opengauss ~]$ ls
   openGauss-Server-6.0.2-CentOS7-x86_64.tar.bz2
   [omm@opengauss ~]$ tar -jxf openGauss-Server-6.0.2-CentOS7-x86_64.tar.bz2 -C /utxt/soft/openGauss/
   [omm@opengauss ~]$ ll /utxt/soft/openGauss/
   total 16
   drwxr-xr-x 2 omm dbgroup 4096 Jul 15 15:29 bin
   drwxr-xr-x 3 omm dbgroup   22 Jul 15 15:29 etc
   drwxr-xr-x 3 omm dbgroup   24 Jul 15 15:29 include
   drwxr-xr-x 4 omm dbgroup   95 Jul 15 15:29 jre
   drwxr-xr-x 6 omm dbgroup 4096 Jul 15 15:29 lib
   drwxr-xr-x 5 omm dbgroup   53 Jul 15 15:29 share
   drwxr-xr-x 2 omm dbgroup   78 Jul 15 15:29 simpleInstall
   -rw-r--r-- 1 omm dbgroup   47 Jul 15 15:29 version.cfg
   
   ```

## 2 éƒ¨ç½²

1. è¿›å…¥ç›®å½•ä¸‹çš„ simpleInstall

   ```bash
   cd /utxt/soft/openGauss/simpleInstall
   ```

2. æ‰§è¡Œinstall.shè„šæœ¬å®‰è£…openGauss

   ```bash
   sh install.sh  -w ****
   ```

   ä¸Šè¿°å‘½ä»¤ä¸­ï¼Œ-wæ˜¯æŒ‡åˆå§‹åŒ–æ•°æ®åº“å¯†ç ï¼ˆgs_initdbæŒ‡å®šï¼‰ï¼Œå®‰å…¨éœ€è¦å¿…é¡»è®¾ç½®ã€‚

   ::: warning å¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹æŠ¥é”™ï¼š

   ```bash
   [step 1]: check parameter
   [step 2]: check install env and os setting
   On systemwide basis, the maximum number of SEMMNI is not correct. the current SEMMNI value is: 128. Please check it.
   The required value should be greater than 321. You can modify it in file '/etc/sysctl.conf'.
   ```

   è¿™æ˜¯å› ä¸ºï¼š**å½“å‰ Linux ç³»ç»Ÿçš„å†…æ ¸å‚æ•° `kernel.sem` ä¸­çš„ `SEMMNI` å€¼ä¸æ»¡è¶³ openGauss æ•°æ®åº“çš„æœ€ä½è¿è¡Œè¦æ±‚ã€‚** openGauss å®ä¾‹éœ€è¦æ›´å¤šçš„ä¿¡å·é‡é›†æ¥æ­£å¸¸å·¥ä½œã€‚

   éœ€è¦ä»¥ `root` ç”¨æˆ·èº«ä»½ä¿®æ”¹ `/etc/sysctl.conf` æ–‡ä»¶æ¥è°ƒæ•´ `SEMMNI` çš„å€¼

   ```bash
   # æ ¼å¼ä¸º: SEMMSL SEMMNS SEMOPM SEMMNI
   kernel.sem = 250 32000 100 1024 
   ```

   ä½¿å¾—æ–°çš„å†…æ ¸å‚æ•°ç”Ÿæ•ˆï¼š`sudo sysctl -p`

   æŸ¥çœ‹`SEMMNI` å€¼æ˜¯å¦å·²æ›´æ–°ï¼š`sysctl kernel.sem`

   :::

3. å®‰è£…æ‰§è¡Œå®Œæˆåï¼Œä½¿ç”¨pså’Œgs_ctlæŸ¥çœ‹è¿›ç¨‹æ˜¯å¦æ­£å¸¸ã€‚

   ```bash
   ps ux | grep gaussdb
   
   gs_ctl query -D /utxt/soft/openGauss/data/single_node
   ```

   nih

   ::: tip

   è¿™é‡Œ gs_ctl å¯èƒ½ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œéœ€è¦å…ˆæŠŠopenGaussç›®å½•çš„ bin ç›®å½•åŠ å…¥åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼š

   ```bash
   export PATH=$PATH:/utxt/soft/openGauss/bin
   ```
   
   :::

## 3 è®¿é—® openGauss

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ gsql è®¿é—® openGaussï¼Œgsqlæ˜¯openGaussæä¾›çš„åœ¨å‘½ä»¤è¡Œä¸‹è¿è¡Œçš„æ•°æ®åº“è¿æ¥å·¥å…·ã€‚æ­¤å·¥å…·é™¤äº†å…·å¤‡æ“ä½œæ•°æ®åº“çš„åŸºæœ¬åŠŸèƒ½ï¼Œè¿˜æä¾›äº†è‹¥å¹²é«˜çº§ç‰¹æ€§ï¼Œä¾¿äºç”¨æˆ·ä½¿ç”¨ã€‚

1. ä»¥æ“ä½œç³»ç»Ÿç”¨æˆ·ommç™»å½•æ•°æ®åº“ä¸»èŠ‚ç‚¹ã€‚

2. è¿æ¥æ•°æ®åº“ã€‚

   æ•°æ®åº“å®‰è£…å®Œæˆåï¼Œé»˜è®¤ç”Ÿæˆåç§°ä¸ºpostgresçš„æ•°æ®åº“ã€‚ç¬¬ä¸€æ¬¡è¿æ¥æ•°æ®åº“æ—¶å¯ä»¥è¿æ¥åˆ°æ­¤æ•°æ®åº“ã€‚

   æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿æ¥æ•°æ®åº“ã€‚

   ```bash
   gsql -d postgres -p 5432
   ```

   å…¶ä¸­postgresä¸ºéœ€è¦è¿æ¥çš„æ•°æ®åº“åç§°ï¼Œ5432ä¸ºæ•°æ®åº“ä¸»èŠ‚ç‚¹çš„ç«¯å£å·ã€‚è¯·æ ¹æ®å®é™…æƒ…å†µæ›¿æ¢ã€‚å¦å¤–ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»»ä¸€å‘½ä»¤è¿æ¥æ•°æ®åº“ã€‚

   ```bash
   gsql postgres://omm:******@127.0.0.1:5432/postgres -r 
   gsql -d "host=127.0.0.1 port=5432 dbname=postgres user=omm password=******"
   ```

   è¿æ¥æˆåŠŸåï¼Œç³»ç»Ÿæ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹ä¿¡æ¯ï¼š

   ```bash
   [omm@opengauss ~]$ gsql -d postgres -p 5432
   gsql ((openGauss 6.0.2 build 6285c0ef) compiled at 2025-07-15 15:13:08 commit 0 last mr 8059 )
   Non-SSL connection (SSL connection is recommended when requiring high-security)
   Type "help" for help.
   
   openGauss=#	
   ```

   ommç”¨æˆ·æ˜¯ç®¡ç†å‘˜ç”¨æˆ·ï¼Œå› æ­¤ç³»ç»Ÿæ˜¾ç¤ºâ€œDBNAME=#â€ã€‚è‹¥ä½¿ç”¨æ™®é€šç”¨æˆ·èº«ä»½ç™»å½•å’Œè¿æ¥æ•°æ®åº“ï¼Œç³»ç»Ÿæ˜¾ç¤ºâ€œDBNAME=>â€ã€‚

   â€œNon-SSL connectionâ€è¡¨ç¤ºæœªä½¿ç”¨SSLæ–¹å¼è¿æ¥æ•°æ®åº“ã€‚å¦‚æœéœ€è¦é«˜å®‰å…¨æ€§æ—¶ï¼Œè¯·[ä½¿ç”¨SSLè¿æ¥](https://docs.opengauss.org/zh/docs/6.0.0/docs/DeveloperGuide/è¿æ¥æ•°æ®åº“_ä»¥SSLæ–¹å¼.html)ã€‚

3. ä¸‹é¢æ˜¯ä¿®æ”¹å¯†ç çš„æ–¹æ³•ï¼š

   ```
   openGauss=# ALTER ROLE omm IDENTIFIED BY '$$$$$$$$' REPLACE 'XXXXXXXX';
   ```

4. é€€å‡ºæ•°æ®åº“ã€‚

   ```
   openGauss=# \q
   ```

## 4 å¼€å¯è¿œç¨‹è®¿é—®

openGauss é»˜è®¤åªå…è®¸ `127.0.0.1` (æœ¬åœ°å›ç¯åœ°å€) è®¿é—®ï¼Œè¿™æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ã€‚

![CleanShot 2025-10-16 at 12.43.35@2x](http://cdn.zhouchuang.site/imgs/2025/10/20251016124354.png)

1. ç¡®ä¿å¼€æ”¾äº†ç›¸å…³ç«¯å£çš„é˜²ç«å¢™

2. è¦é…ç½® openGauss ä»¥å…è®¸**è¿œç¨‹è®¿é—®**ï¼Œä½ éœ€è¦ä¿®æ”¹ openGauss æœåŠ¡å™¨ä¸Šçš„ä¸¤ä¸ªæ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š

   1. **`postgresql.conf`ï¼šç”¨äºé…ç½®æ•°æ®åº“å®ä¾‹çš„**ç›‘å¬åœ°å€ã€‚

      ```bash
      vim /utxt/soft/openGauss/data/single_node/postgresql.conf
      
      # æ‰¾åˆ° listen_addresses æ”¹ä¸º
      listen_addresses = '*'
      ```

   2. **`pg_hba.conf`**ï¼šç”¨äºé…ç½®å®¢æˆ·ç«¯çš„**è®¤è¯è§„åˆ™**ã€‚(<mark>ä¸‹é¢METHODæœ€å¥½æ”¹ä¸ºmd5ï¼Œæœ‰ä¸ªå‘</mark>)

      ä½ éœ€è¦å®šä¹‰å“ªäº› IP åœ°å€èŒƒå›´ã€å“ªäº›ç”¨æˆ·å¯ä»¥è®¿é—®å“ªäº›æ•°æ®åº“ï¼Œä»¥åŠä½¿ç”¨å“ªç§è®¤è¯æ–¹å¼ã€‚

      ```bash
      vim /utxt/soft/openGauss/data/single_node/pg_hba.conf
      
      # åœ¨æœ«å°¾æ·»åŠ è§„åˆ™
      # TYPE  DATABASE        USER            ADDRESS                 METHOD
      host    all             all             0.0.0.0/0               sha256
      ```

      | **å­—æ®µ**   | **å€¼**      | **å«ä¹‰**                                                     |
      | ---------- | ----------- | ------------------------------------------------------------ |
      | `TYPE`     | `host`      | å…è®¸ TCP/IP è¿æ¥ã€‚                                           |
      | `DATABASE` | `all`       | å…è®¸è¿æ¥åˆ°**æ‰€æœ‰**æ•°æ®åº“ã€‚                                   |
      | `USER`     | `all`       | å…è®¸**æ‰€æœ‰**æ•°æ®åº“ç”¨æˆ·è¿æ¥ã€‚                                 |
      | `ADDRESS`  | `0.0.0.0/0` | **å…è®¸æ‰€æœ‰ IPv4 åœ°å€**è¿æ¥ã€‚                                 |
      | `METHOD`   | `sha256`    | å¼ºåˆ¶ä½¿ç”¨å¯†ç ï¼ˆSHA256åŠ å¯†ï¼‰è¿›è¡Œè®¤è¯ã€‚è¿™æ˜¯**æ¨èä¸”å®‰å…¨çš„**æ–¹å¼ã€‚ |

      ğŸ”’ ä¸ºäº†æ›´å®‰å…¨ï¼Œä½ ä¹Ÿå¯ä»¥é™åˆ¶ IP èŒƒå›´ï¼š

      ```bash
      # å…è®¸ 192.168.1.x å­ç½‘å†…çš„æ‰€æœ‰ä¸»æœºè®¿é—®
      host    all             all             192.168.1.0/24          sha256
      ```

   3. é‡å¯**æˆ–**é‡è½½é…ç½®

      - **é‡è½½é…ç½®ï¼ˆæ¨èï¼Œæ— éœ€ä¸­æ–­æœåŠ¡ï¼‰ï¼š** ä½¿ç”¨ `gs_ctl reload` å‘½ä»¤é‡è½½é…ç½®ã€‚

        ```bash
        [omm@opengauss ~]$ gs_ctl reload -D /utxt/soft/openGauss/data/single_node
        [2025-10-16 12:49:57.139][72874][][gs_ctl]: gs_ctl reload ,datadir is /utxt/soft/openGauss/data/single_node
        server signaled
        
        # æŸ¥çœ‹ç«¯å£å¼€æ”¾æƒ…å†µ
        [omm@opengauss ~]$ netstat -tlnp |grep gaussdb
        (Not all processes could be identified, non-owned process info
         will not be shown, you would have to be root to see it all.)
        tcp        0      0 0.0.0.0:5432            0.0.0.0:*               LISTEN      33078/gaussdb
        tcp        0      0 0.0.0.0:5433            0.0.0.0:*               LISTEN      33078/gaussdb
        tcp6       0      0 :::5432                 :::*                    LISTEN      33078/gaussdb
        tcp6       0      0 :::5433                 :::*                    LISTEN      33078/gaussdb
        ```

      - é‡å¯æ•°æ®åº“ï¼ˆå¦‚æœé‡è½½å¤±è´¥æˆ–ä¸ç¡®å®šï¼‰ï¼š

        ```bash
        # é‡å¯æ•°æ®åº“å‘½ä»¤æ ¼å¼
        gs_ctl restart -D $GAUSSHOME/data/datanode
        ```

   ::: warning

   **openGauss é»˜è®¤æƒ…å†µä¸‹ç¦æ­¢**ä½¿ç”¨**åˆå§‹ç”¨æˆ·**ï¼ˆå³å®‰è£… openGauss æ—¶é»˜è®¤åˆ›å»ºçš„ç®¡ç†å‘˜ç”¨æˆ·ï¼Œé€šå¸¸æ˜¯ **`omm`** æˆ–åœ¨æŸäº›é…ç½®ä¸­æŒ‡å®šçš„ç®¡ç†å‘˜ï¼‰è¿›è¡Œ**è¿œç¨‹è¿æ¥**ã€‚

   :::

3. åˆ›å»ºæ™®é€šç”¨æˆ·

   ```bash
   [omm@opengauss ~]$ gsql -d postgres -p 5432 -U omm
   gsql ((openGauss 6.0.2 build 6285c0ef) compiled at 2025-07-15 15:13:08 commit 0 last mr 8059 )
   Non-SSL connection (SSL connection is recommended when requiring high-security)
   Type "help" for help.
   
   openGauss=# CREATE USER remote_user WITH PASSWORD '**å¯†ç **';
   CREATE ROLE
   ```

   æˆäºˆæƒé™ï¼š

   ```bash
   -- å¦‚æœéœ€è¦ç®¡ç†å‘˜æƒé™ï¼ˆä¸æ¨èç”¨äºæ—¥å¸¸æ“ä½œï¼‰
   -- GRANT SYSADMIN TO remote_user; 
   
   -- å¦‚æœéœ€è¦è¿æ¥åˆ°ç‰¹å®šæ•°æ®åº“
   -- GRANT CONNECT ON DATABASE your_database TO remote_user;
   ```

   ![CleanShot 2025-10-16 at 13.11.15@2x](http://cdn.zhouchuang.site/imgs/2025/10/20251016131134.png)

   ::: tip

   ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ Navicatã€DataGrip å·¥å…·ï¼Œé€šè¿‡ç”¨æˆ·: remote_user è¿œç¨‹è¿æ¥æ•°æ®åº“å¯èƒ½ä¼šå‡ºç°ä¸‹é¢é—®é¢˜ï¼š

   `[08004] Invalid or unsupported by client SCRAM mechanisms.`

   `none of the server's SASL authentication mechanisms are supported`

   åŸå› æ˜¯ï¼šæ•°æ®åº“ï¼ˆæœåŠ¡å™¨ï¼‰å’Œè¿æ¥å·¥å…·ï¼ˆå®¢æˆ·ç«¯ï¼‰åœ¨åå•†å¯†ç åŠ å¯†å’ŒéªŒè¯æ–¹æ³•æ—¶ï¼Œæ²¡æœ‰æ‰¾åˆ°å…±åŒæ”¯æŒçš„æœºåˆ¶ã€‚

   ä¿®å¤æ–¹æ³•ï¼š

   1. vim /utxt/soft/openGauss/data/single_node/pg_hba.conf

      `host    all             all             0.0.0.0/0               md5`

   2. vim /utxt/soft/openGauss/data/single_node/postgresql.conf

      `password_encryption_type = 0`

   3. é‡æ–°å…³é—­ã€å¯åŠ¨æ•°æ®åº“

      ```bash
      gs_ctl stop -D /utxt/soft/openGauss/data/single_node
      gs_ctl start -D /utxt/soft/openGauss/data/single_node
      ```

   4. è¿›å…¥æ•°æ®åº“ï¼Œæ›´æ–°å¯†ç 

      ```
      ALTER USER remote_user WITH PASSWORD '***å¯†ç ***';
      ```

   :smile: æ­¤æ—¶ï¼Œæ•°æ®åº“å°±èƒ½è¿æ¥äº†ã€‚

   :::

## 5 gsql å¸¸ç”¨è¯­æ³•

`gsq` æ˜¯ openGauss æä¾›çš„å‘½ä»¤è¡Œæ•°æ®åº“è¿æ¥å·¥å…·ï¼Œç±»ä¼¼äº PostgreSQL çš„ `psql`ã€‚

å¸¸è§çš„è¿æ¥æ–¹æ³•ï¼š
```bash
gsql -d postgres -h 10.10.0.11 -U jack -p 8000 -W Test@123
```

`gsql` å·¥å…·ä½¿ç”¨ä¸€å¥—æ ‡å‡†çš„å‚æ•°æ¥æŒ‡å®šè¿æ¥ä¿¡æ¯ï¼š

| å‚æ•° | å«ä¹‰                          | ç¤ºä¾‹å€¼                              |
| ---- | ----------------------------- | ----------------------------------- |
| `-d` | **æ•°æ®åº“å**ï¼ˆDatabase Nameï¼‰ | `postgres` (é»˜è®¤æ•°æ®åº“)             |
| `-U` | **ç”¨æˆ·å**ï¼ˆUser Nameï¼‰       | `omm` (é»˜è®¤ç®¡ç†å‘˜) æˆ–å…¶ä»–è‡ªå®šä¹‰ç”¨æˆ· |
| `-h` | **ä¸»æœºåæˆ–IPåœ°å€**ï¼ˆHostï¼‰    | `localhost` æˆ– `192.168.1.100`      |
| `-p` | **ç«¯å£å·**ï¼ˆPortï¼‰            | å®‰è£…æ—¶æŒ‡å®šçš„ç«¯å£                    |
| `-W` | **å¼ºåˆ¶è¾“å…¥å¯†ç **ï¼ˆPasswordï¼‰  | **ï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰**                |

è¿æ¥åçš„æ“ä½œï¼š

| æ“ä½œ           | å‘½ä»¤                               | ç¤ºä¾‹                         |
| -------------- | ---------------------------------- | ---------------------------- |
| **æ‰§è¡Œ SQL**   | ç›´æ¥è¾“å…¥ SQL è¯­å¥ï¼Œä»¥åˆ†å· `;` ç»“å°¾ | `SELECT * FROM pg_database;` |
| **åˆ—å‡ºæ•°æ®åº“** | å…ƒå‘½ä»¤ï¼šåˆ—å‡ºæ•°æ®åº“                 | `\l`                         |
| **åˆ‡æ¢æ•°æ®åº“** | å…ƒå‘½ä»¤ï¼šè¿æ¥åˆ°æ–°æ•°æ®åº“             | `\c new_db`                  |
| **åˆ—å‡ºè¡¨**     | å…ƒå‘½ä»¤ï¼šåˆ—å‡ºå½“å‰ Schema çš„è¡¨       | `\dt`                        |
| **è·å–å¸®åŠ©**   | å…ƒå‘½ä»¤ï¼šæ˜¾ç¤ºå¸®åŠ©                   | `\?`                         |
| **é€€å‡º**       | å…ƒå‘½ä»¤ï¼šé€€å‡º gsql                  | `\q`                         |
