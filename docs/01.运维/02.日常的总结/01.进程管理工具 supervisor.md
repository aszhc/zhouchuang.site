---
title: è¿›ç¨‹ç®¡ç†å·¥å…·ï¼šsupervisor
date: 2024-12-05 21:54:19
permalink: /Ops/daily-summary/supervisor/
categories:
  - è¿ç»´
tags:
  - è¿›ç¨‹ç®¡ç†
  - supervisor
  - nohup
author: 
  name: ZhouChuang
  link: https://github.com/aszhc
---



æœ¬æ–‡è¯¦è¿°äº†è¿›ç¨‹ç®¡ç†å·¥å…· `supervisor` çš„ä½¿ç”¨ï¼Œä»è¿›ç¨‹çš„åŸºæœ¬æ¦‚å¿µåˆ°å¦‚ä½•é…ç½®å’Œç®¡ç†è¿›ç¨‹ï¼Œæä¾›äº†ä»å®‰è£…åˆ°å®é™…åº”ç”¨çš„å…¨é¢æŒ‡å—ã€‚æ–‡ä¸­æ¯”è¾ƒäº† `nohup` å’Œ `supervisor`ï¼Œå±•ç¤ºäº† `supervisor` åœ¨è‡ªåŠ¨é‡å¯ã€æ—¥å¿—ç®¡ç†å’Œè¿›ç¨‹ç›‘æ§ç­‰æ–¹é¢çš„ä¼˜åŠ¿ã€‚

<!-- more -->

## è¿›ç¨‹

è¿›ç¨‹æŒ‡çš„æ˜¯ä¸€ä¸ªç¨‹åºåœ¨æ“ä½œç³»ç»Ÿä¸­**è¿è¡Œæ—¶çš„å®ä¾‹**ã€‚ç¨‹åºæœ¬èº«æ˜¯é™æ€çš„ä»£ç å’Œæ•°æ®ï¼Œè€Œè¿›ç¨‹åˆ™æ˜¯ç¨‹åºçš„åŠ¨æ€è¡¨ç°å½¢å¼ï¼ŒåŒ…æ‹¬æ‰§è¡Œçš„æŒ‡ä»¤ã€åˆ†é…çš„èµ„æºå’Œè¿è¡Œæ—¶çš„çŠ¶æ€ã€‚

* ç¨‹åº vs è¿›ç¨‹
  * **ç¨‹åº**æ˜¯ä¿å­˜åœ¨ç£ç›˜ä¸Šçš„æŒ‡ä»¤é›†åˆï¼Œæ˜¯é™æ€çš„ã€‚
  * **è¿›ç¨‹**æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œï¼Œæ˜¯åŠ¨æ€çš„ï¼Œå®ƒåŒ…å«ç¨‹åºçš„æŒ‡ä»¤ã€è¿è¡Œæ—¶çš„èµ„æºå’ŒçŠ¶æ€ã€‚

**è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸ**

è¿›ç¨‹åœ¨åˆ›å»ºåˆ°é”€æ¯çš„è¿‡ç¨‹ä¸­ï¼Œéƒ½ä¼šç»å†äº”ç§çŠ¶æ€çš„è½¬æ¢

:::center

![è¿›ç¨‹çŠ¶æ€åˆ‡æ¢å›¾](http://cdn.zhouchuang.site/img/20241205231814011.png)

:::

* åˆ›å»ºï¼šè¿›ç¨‹åœ¨åˆ›å»ºæ—¶éœ€è¦ç”³è¯·ä¸€ä¸ªç©ºç™½PCBï¼Œå‘å…¶ä¸­å¡«å†™æ§åˆ¶å’Œç®¡ç†è¿›ç¨‹çš„ä¿¡æ¯ï¼Œå®Œæˆèµ„æºåˆ†é…ã€‚å¦‚æœåˆ›å»ºå·¥ä½œæ— æ³•å®Œæˆï¼Œæ¯”å¦‚èµ„æºæ— æ³•æ»¡è¶³ï¼Œå°±æ— æ³•è¢«è°ƒåº¦è¿è¡Œï¼ŒæŠŠæ­¤æ—¶è¿›ç¨‹æ‰€å¤„çŠ¶æ€ç§°ä¸ºåˆ›å»ºçŠ¶æ€ã€‚
* å°±ç»ªï¼šè¿›ç¨‹å·²ç»å‡†å¤‡å¥½ï¼Œå·²åˆ†é…åˆ°æ‰€éœ€èµ„æºï¼Œåªè¦åˆ†é…åˆ°CPUå°±èƒ½å¤Ÿç«‹å³è¿è¡Œã€‚
* æ‰§è¡Œï¼šè¿›ç¨‹å¤„äºå°±ç»ªçŠ¶æ€è¢«è°ƒåº¦åï¼Œè¿›ç¨‹è¿›å…¥æ‰§è¡ŒçŠ¶æ€ã€‚
* é˜»å¡ï¼šæ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ç”±äºæŸäº›äº‹ä»¶ï¼ˆI/Oè¯·æ±‚ï¼Œç”³è¯·ç¼“å­˜åŒºå¤±è´¥ï¼‰è€Œæš‚æ—¶æ— æ³•è¿è¡Œï¼Œè¿›ç¨‹å—åˆ°é˜»å¡ã€‚åœ¨æ»¡è¶³è¯·æ±‚æ—¶è¿›å…¥å°±ç»ªçŠ¶æ€ç­‰å¾…ç³»ç»Ÿè°ƒç”¨
* ç»ˆæ­¢ï¼šè¿›ç¨‹ç»“æŸï¼Œæˆ–å‡ºç°é”™è¯¯ï¼Œæˆ–è¢«ç³»ç»Ÿç»ˆæ­¢ï¼Œè¿›å…¥ç»ˆæ­¢çŠ¶æ€ã€‚æ— æ³•å†æ‰§è¡Œ

## å‰å°è¿›ç¨‹å’Œåå°è¿›ç¨‹

åœ¨æ“ä½œç³»ç»Ÿä¸­ï¼Œè¿›ç¨‹é€šå¸¸å¯ä»¥åˆ†ä¸º**å‰å°è¿›ç¨‹**ï¼ˆforeground processï¼‰å’Œ**åå°è¿›ç¨‹**ï¼ˆbackground processï¼‰ã€‚è¿™ä¸¤è€…çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨å®ƒä»¬å¦‚ä½•ä¸ç»ˆç«¯äº¤äº’ã€å¦‚ä½•å ç”¨ç³»ç»Ÿèµ„æºä»¥åŠå¦‚ä½•ç®¡ç†ã€‚

> **å‰å°è¿›ç¨‹**

**å‰å°è¿›ç¨‹**æ˜¯æŒ‡ä¸ç”¨æˆ·çš„ç»ˆç«¯ä¼šè¯ç›´æ¥äº¤äº’çš„è¿›ç¨‹ã€‚é€šå¸¸ï¼Œè¿™äº›è¿›ç¨‹ä¼šå ç”¨å½“å‰ç»ˆç«¯çš„æ§åˆ¶æƒï¼Œç›´åˆ°å®ƒä»¬æ‰§è¡Œå®Œæ¯•ã€‚

**ç‰¹ç‚¹**ï¼šä¸ç”¨æˆ·äº¤äº’ã€å ç”¨ç»ˆç«¯ã€é˜»å¡å¼è¿è¡Œ

> **åå°è¿›ç¨‹**

**åå°è¿›ç¨‹**æ˜¯æŒ‡ä¸ä¼šç›´æ¥ä¸ç”¨æˆ·äº¤äº’ï¼Œè€Œæ˜¯å°†æ§åˆ¶æƒäº¤è¿˜ç»™ç»ˆç«¯çš„è¿›ç¨‹ã€‚åå°è¿›ç¨‹åœ¨è¿è¡Œæ—¶ä¸å ç”¨ç»ˆç«¯ï¼Œå¯ä»¥è®©ç”¨æˆ·ç»§ç»­åœ¨åŒä¸€ç»ˆç«¯ä¸Šè¿è¡Œå…¶ä»–å‘½ä»¤ã€‚

**ç‰¹ç‚¹**ï¼šä¸ä¸ç”¨æˆ·äº¤äº’ã€ä¸é˜»å¡ç»ˆç«¯

> **é€‚ç”¨åœºæ™¯**

**å‰å°è¿›ç¨‹**ï¼š

- é€‚åˆéœ€è¦ç”¨æˆ·è¾“å…¥æˆ–è¾“å‡ºçš„ä»»åŠ¡ï¼Œæ¯”å¦‚äº¤äº’å¼å‘½ä»¤ã€ç¼–è¾‘æ–‡ä»¶ã€ç¼–è¯‘ç¨‹åºç­‰ã€‚
- ç”¨æˆ·éœ€è¦ç­‰å¾…è¿›ç¨‹å®Œæˆæ‰èƒ½ç»§ç»­å…¶ä»–æ“ä½œã€‚

**åå°è¿›ç¨‹**ï¼š

- é€‚åˆéœ€è¦é•¿æ—¶é—´è¿è¡Œã€ä¸éœ€è¦ç”¨æˆ·å¹²é¢„çš„ä»»åŠ¡ï¼Œå¦‚ï¼š
  - æ•°æ®å¤‡ä»½
  - Web æœåŠ¡å™¨ã€æ•°æ®åº“æœåŠ¡ç­‰å®ˆæŠ¤è¿›ç¨‹
  - å®šæ—¶ä»»åŠ¡ï¼ˆä¾‹å¦‚ï¼Œcron ä½œä¸šï¼‰
  - ...

## å¦‚ä½•å°†å‰å°è¿›ç¨‹è½¬ä¸ºåå°è¿›ç¨‹

>å¸¸è§çš„ä¸¤ç§æ–¹æ³•ï¼š

**æ–¹æ³• 1ï¼šåœ¨å‘½ä»¤ååŠ  `&`**

è¿™æ ·å¯ä»¥æŠŠè¿™ä¸ªå‘½ä»¤æ”¾åˆ°åå°æ‰§è¡Œï¼Œä¾‹å¦‚ï¼šæ¯10såœ¨åå°æ‰§è¡Œä¸€æ¬¡test.shè„šæœ¬

`watch -n 10 sh test.sh &` 

ä½†æ˜¯è¿™ç§ç¼ºç‚¹æ˜¯å¦‚æœæˆ‘ä»¬å…³é—­å½“å‰ç»ˆç«¯ï¼Œæ­¤è¿›ç¨‹ä¹Ÿä¼šè¢«æ€æ­»ã€‚

**æ–¹æ³• 2ï¼šnohup**

å¦‚æœè®©ç¨‹åºå§‹ç»ˆåœ¨åå°æ‰§è¡Œï¼Œå³ä½¿å…³é—­å½“å‰çš„ç»ˆç«¯ä¹Ÿæ‰§è¡Œï¼Œè¿™æ—¶å€™éœ€è¦nohupã€‚

nohup å‘½ä»¤å¯ä»¥å°†ç¨‹åºä»¥<mark>å¿½ç•¥æŒ‚èµ·ä¿¡å·(SIGHUP)</mark>çš„æ–¹å¼è¿è¡Œèµ·æ¥ï¼Œè¢«è¿è¡Œçš„ç¨‹åºçš„è¾“å‡ºä¿¡æ¯å°†ä¸ä¼šæ˜¾ç¤ºåˆ°ç»ˆç«¯ã€‚

æ— è®ºæ˜¯å¦å°† nohup å‘½ä»¤çš„è¾“å‡ºé‡å®šå‘åˆ°ç»ˆç«¯ï¼Œè¾“å‡ºéƒ½ä¼šå°†å†™å…¥åˆ°å½“å‰ç›®å½•çš„ nohup.out æ–‡ä»¶ä¸­ã€‚å¦‚æœå½“å‰ç›®å½•çš„ nohup.out æ–‡ä»¶ä¸å¯å†™ï¼Œåˆ™è¾“å‡ºé‡å®šå‘åˆ° $HOME/nohup.out æ–‡ä»¶ä¸­ã€‚

## nohup

`nohup`æ˜¯Linuxå’ŒUnixç³»ç»Ÿä¸­çš„ä¸€ä¸ªå‘½ä»¤ï¼Œå…¶ä½œç”¨æ˜¯åœ¨ç»ˆç«¯é€€å‡ºæ—¶ï¼Œè®©è¿›ç¨‹åœ¨åå°ç»§ç»­è¿è¡Œã€‚å®ƒçš„å…¨ç§°ä¸ºâ€œno hang upâ€ï¼Œæ„ä¸ºâ€œä¸æŒ‚èµ·â€ã€‚`nohup`å‘½ä»¤å¯ä»¥è®©ä½ åœ¨é€€å‡ºç»ˆç«¯æˆ–å…³é—­SSHè¿æ¥åç»§ç»­è¿è¡Œå‘½ä»¤ã€‚

**åŸºæœ¬è¯­æ³•æ ¼å¼ï¼š**

```bash
 nohup Command [ Arg â€¦ ] [ã€€& ]
```

Commandï¼šè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚

Argï¼šä¸€äº›å‚æ•°ï¼Œå¯ä»¥æŒ‡å®šè¾“å‡ºæ–‡ä»¶ã€‚

&ï¼šè®©å‘½ä»¤åœ¨åå°æ‰§è¡Œï¼Œç»ˆç«¯é€€å‡ºåå‘½ä»¤ä»æ—§æ‰§è¡Œã€‚

### æ‰§è¡Œè¿‡ç¨‹

nohupå‘½ä»¤çš„æ‰§è¡Œè¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

1. å±è”½æŒ‚èµ·ä¿¡å·ï¼š

   `nohup` å‘½ä»¤ä¼šè®©ç›®æ ‡è¿›ç¨‹å¿½ç•¥ç»ˆç«¯å…³é—­æ—¶å‘é€çš„æŒ‚èµ·ä¿¡å·ï¼ˆSIGHUPï¼‰ï¼Œç¡®ä¿è¿›ç¨‹ä¸ä¼šå› ç»ˆç«¯å…³é—­è€Œä¸­æ–­ã€‚

2. é‡å®šå‘è¾“å‡ºï¼š

   å¦‚æœæ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šï¼Œ`nohup` ä¼šå°†è¿›ç¨‹çš„è¾“å‡ºå’Œé”™è¯¯ä¿¡æ¯ä¿å­˜åˆ° `nohup.out` æ–‡ä»¶ä¸­ã€‚

   å¦‚æœæŒ‡å®šäº†é‡å®šå‘ï¼Œåˆ™è¾“å‡ºæŒ‰ç”¨æˆ·çš„é…ç½®ä¿å­˜ã€‚

3. å¯åŠ¨ç›®æ ‡è¿›ç¨‹ï¼š

   `nohup` è°ƒç”¨ç›®æ ‡ç¨‹åºå¹¶å°†å…¶ä½œä¸ºä¸€ä¸ªç‹¬ç«‹è¿›ç¨‹è¿è¡Œã€‚

4. åå°è¿è¡Œï¼ˆå¯é€‰ï¼‰ï¼š

   ä½¿ç”¨ `&` å¯ä»¥å°†è¿›ç¨‹æ”¾å…¥åå°æ‰§è¡Œï¼Œä¸å ç”¨ç»ˆç«¯ã€‚

### å¸¸è§çš„ä½¿ç”¨æ–¹æ³•

1. åå°è¿è¡Œå‘½ä»¤

   ```bash
   nohup COMMAND &
   
   # ä¾‹å¦‚ï¼šåœ¨åå°è¿è¡Œä¸€ä¸ªBashè„šæœ¬
   nohup bash test.sh &
   ```

2. æ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶

   ```bash
   nohup bash test.sh > stdout.txt &
   ```

3. æ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶

   ```bash
   nohup bash test.sh 2> stderr.txt &
   ```

4. å°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºéƒ½é‡å®šå‘åˆ°æ–‡ä»¶

   * é‡å®šå‘åˆ°åŒä¸€æ–‡ä»¶

     ```bash
     nohup bash test.sh > output.txt 2>&1 &
     ```

   * é‡å®šå‘åˆ°ä¸åŒæ–‡ä»¶

     ```bash
     nohup bash test.sh > stdout.txt 2> stderr.txt &
     ```

5. ä½¿ç”¨ `jobs` å‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ shell ä¸­åå°è¿è¡Œçš„ä»»åŠ¡åˆ—è¡¨ï¼ŒåŒ…æ‹¬ä»»åŠ¡ç¼–å·ã€çŠ¶æ€å’Œå‘½ä»¤ã€‚å¹¶ä½¿ç”¨`fg`å‘½ä»¤å°†è¿›ç¨‹åˆ‡æ¢åˆ°å‰å°è¿è¡Œ

### nohupçš„ä¸è¶³

`nohup` æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼š

1. ç®€å•ï¼š`nohup` éå¸¸ç®€å•æ˜“ç”¨ï¼Œé€‚ç”¨äºå¿«é€Ÿå¯åŠ¨ä¸€ä¸ªä¸éœ€è¦å¤æ‚ç®¡ç†çš„åå°ä»»åŠ¡ã€‚
2. ä¸éœ€è¦é¢å¤–å®‰è£…ï¼šåœ¨å¤§å¤šæ•° Unix æˆ– Linux ç³»ç»Ÿä¸Šï¼Œ`nohup` æ˜¯é»˜è®¤å®‰è£…çš„ï¼Œä¸éœ€è¦é¢å¤–é…ç½®ã€‚
3. èµ„æºå ç”¨ä½ï¼š`nohup` æœ¬èº«ä¸ä¼šå ç”¨å¤ªå¤šç³»ç»Ÿèµ„æºã€‚

ä½†æ˜¯`nohup`çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š

1. **æ— è¿›ç¨‹ç®¡ç†**ï¼šä¸€æ—¦è¿›ç¨‹å¯åŠ¨ï¼Œ`nohup` ä¸ä¼šæä¾›ä»»ä½•ç›‘æ§æˆ–ç®¡ç†åŠŸèƒ½ã€‚å¦‚æœè¿›ç¨‹æŒ‚æ‰ï¼Œå®ƒä¸ä¼šè‡ªåŠ¨é‡å¯ã€‚
2. **æ—¥å¿—ç®¡ç†ä¸ä¾¿**ï¼šè™½ç„¶ `nohup` å¯ä»¥å°†è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶ï¼Œä½†æ—¥å¿—æ–‡ä»¶ç®¡ç†ï¼ˆå¦‚æ—¥å¿—è½®è½¬ã€å‹ç¼©ç­‰ï¼‰éœ€è¦é¢å¤–çš„æ‰‹åŠ¨é…ç½®ã€‚
3. **ç¼ºä¹æ¢å¤æœºåˆ¶**ï¼šå¦‚æœè¿›ç¨‹å› ä¸ºæŸäº›åŸå› é€€å‡ºï¼Œ`nohup` ä¸ä¼šå°è¯•é‡å¯æˆ–é€šçŸ¥ç”¨æˆ·ã€‚
4. **ä¸æ”¯æŒå¤šè¿›ç¨‹**ï¼š`nohup` ä¸€æ¬¡åªèƒ½å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸é€‚åˆç®¡ç†å¤šä¸ªç›¸å…³çš„æœåŠ¡æˆ–è¿›ç¨‹ã€‚

### å¸¸ç”¨æ‹‰èµ·è¿›ç¨‹çš„æ–¹å¼

ä½¿ç”¨ `nohup` è¿è¡Œçš„åå°è¿›ç¨‹å¦‚æœæ„å¤–æŒ‚æ‰ï¼Œé€šå¸¸ä½¿ç”¨å®šæ—¶ä»»åŠ¡æ¥æ£€æŸ¥å¹¶é‡å¯è¿›ç¨‹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

```bash
# ä½¿ç”¨ nohup å¯åŠ¨ä¸€ä¸ªè¿›ç¨‹
[root@test nohup]# nohup ./process 2>&1 &
[1] 7384
```

1. ç›‘æ§è„šæœ¬`/root/nohup/process_monitor.sh`ï¼š

   ```shell
   #!/bin/bash
   
   PROCESS_NAME="process"
   
   if ! pgrep -x "$PROCESS_NAME" > /dev/null
   then
       # å¦‚æœè¿›ç¨‹ä¸å­˜åœ¨ï¼Œåˆ™å¯åŠ¨å®ƒ
       echo "$(date): Starting $PROCESS_NAME" >> /var/log/process_monitor.log
       nohup /root/nohup/process 2>&1 &
       echo $! > /var/run/process.pid  # å°†æ–°è¿›ç¨‹çš„PIDä¿å­˜åˆ°æ–‡ä»¶ä¸­ 
   else
       echo "$(date): $PROCESS_NAME is already running" >> /var/log/process_monitor.log
   fi
   ```

2. ä½¿ç”¨forå¾ªç¯ç›‘æ§å¹¶é‡å¤æ‰§è¡Œç›‘æ§è„šæœ¬ï¼š`/root/nohup/monitor.sh`ï¼š

   ```shell
   #!/bin/bash
   
   # å®šä¹‰å¾ªç¯æ¬¡æ•°ï¼ˆæ¯10ç§’æ£€æŸ¥ä¸€æ¬¡ï¼Œ6æ¬¡ä¸ºä¸€åˆ†é’Ÿï¼‰
   for i in {1..6}; do
       /root/nohup/process_monitor.sh
       sleep 10
   done
   ```

3. è®¾ç½® `crontab` åˆ›å»ºå®šæ—¶ä»»åŠ¡

   ä½¿ç”¨ `crontab -e` ç¼–è¾‘ä½ çš„å®šæ—¶ä»»åŠ¡ï¼Œæ·»åŠ ä»¥ä¸‹è¡Œï¼š

   ```bash
   * * * * * /root/nohup/monitor.sh
   ```

 è‹¥è¿›ç¨‹è¢«æ€æ­»ååœ¨10ç§’å†…ä¼šè¢«è‡ªåŠ¨æ‹‰èµ·ï¼š

```bash
[root@test nohup]# kill -9 7384
[root@test nohup]# ps -ef|grep process
root        7438    5828  0 11:10 pts/1    00:00:00 grep --color=auto process

# å‡ ç§’åæˆåŠŸæ‹‰èµ·äº†è¿›ç¨‹
[root@test nohup]# ps -ef|grep process
root        7444       1  0 11:10 ?        00:00:00 /root/nohup/process
root        7450    5828  0 11:10 pts/1    00:00:00 grep --color=auto process
```

<mark>**è¿™ç§æ–¹å¼çš„ç¼ºç‚¹ï¼š**</mark>

ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼ˆå³åˆ›å»ºç›‘æ§è„šæœ¬ã€for å¾ªç¯è„šæœ¬å’Œ `crontab` å®šæ—¶ä»»åŠ¡ï¼‰æ¥ç›‘æ§å’Œæ¢å¤è¿›ç¨‹æœ‰ä»¥ä¸‹å‡ ä¸ªæ½œåœ¨çš„ç¼ºç‚¹ï¼š

1. **å¤æ‚æ€§å¢åŠ **

   * å¤šå±‚è„šæœ¬ï¼šéœ€è¦ç®¡ç†å¤šä¸ªè„šæœ¬ï¼Œè¿™å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚æ¯ä¸ªè„šæœ¬éƒ½éœ€è¦å•ç‹¬ç»´æŠ¤ã€æµ‹è¯•å’Œæ›´æ–°ã€‚

   * ä¾èµ–æ€§ï¼šè„šæœ¬ä¹‹é—´çš„ä¾èµ–å…³ç³»å¯èƒ½å¯¼è‡´é—®é¢˜ã€‚

2. **æ€§èƒ½å’Œèµ„æºä½¿ç”¨**

   * é¢‘ç¹æ£€æŸ¥ï¼šæ¯10ç§’æ£€æŸ¥ä¸€æ¬¡è¿›ç¨‹çŠ¶æ€å¯èƒ½ä¼šå¯¹ç³»ç»Ÿæ€§èƒ½é€ æˆä¸€å®šçš„å‹åŠ›ï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜è´Ÿè½½ç¯å¢ƒä¸­ã€‚å³ä½¿æ¯ä¸ªæ£€æŸ¥æ“ä½œå¾ˆè½»é‡ï¼Œç´¯ç§¯çš„æ•ˆæœä¹Ÿå¯èƒ½æ˜¾è‘—ã€‚

   * èµ„æºå ç”¨ï¼šå¦‚æœä¸æ­£ç¡®ç®¡ç†ï¼Œå¯èƒ½ä¼šæœ‰å¤šä¸ªè„šæœ¬å®ä¾‹åŒæ—¶è¿è¡Œï¼Œå¯¼è‡´èµ„æºæµªè´¹ã€‚

3. **å¯é æ€§å’Œç¨³å®šæ€§**

   * è„šæœ¬å¤±æ•ˆï¼šå¦‚æœä»»ä½•ä¸€ä¸ªè„šæœ¬ï¼ˆç‰¹åˆ«æ˜¯ loop_monitor.shï¼‰å› æŸç§åŸå› å¤±è´¥æˆ–è¢«ç»ˆæ­¢ï¼Œæ•´ä¸ªç›‘æ§å’Œæ¢å¤æœºåˆ¶å°±ä¼šå¤±æ•ˆã€‚
   * å®šæ—¶ä»»åŠ¡çš„é™åˆ¶ï¼šcrontab åªèƒ½ç²¾ç¡®åˆ°åˆ†é’Ÿçº§åˆ«ï¼Œå› æ­¤ä½¿ç”¨ for å¾ªç¯æ¥å®ç°æ›´çŸ­çš„æ—¶é—´é—´éš”å¯èƒ½ä¼šå¯¼è‡´åœ¨æŸäº›æƒ…å†µä¸‹æ— æ³•åŠæ—¶å“åº”è¿›ç¨‹ç»ˆæ­¢ã€‚

4. **æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§**

   * ç»´æŠ¤æˆæœ¬ï¼šéšç€æ—¶é—´çš„æ¨ç§»ï¼Œç»´æŠ¤å¤šä¸ªè„šæœ¬å¯èƒ½å˜å¾—å¤æ‚ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦æ·»åŠ æ–°åŠŸèƒ½æˆ–ä¿®æ”¹ç°æœ‰é€»è¾‘æ—¶ã€‚

## è¿›ç¨‹ç›‘æ§å·¥å…·

åœ¨ç›¸å¯¹å¤æ‚çš„ç¯å¢ƒä¸­ï¼Œå»ºè®®**è€ƒè™‘ä½¿ç”¨æ›´ä¸“ä¸šçš„ç›‘æ§å’Œç®¡ç†å·¥å…·**ï¼šå¦‚ `systemd`ã€`supervisord`ã€`Monit` ç­‰ï¼Œè¿™äº›å·¥å…·æä¾›äº†æ›´å¥½çš„è¿›ç¨‹ç®¡ç†ã€è‡ªåŠ¨æ¢å¤ã€æ—¥å¿—ç®¡ç†å’Œæ€§èƒ½ç›‘æ§åŠŸèƒ½ã€‚

`systemd` å’Œ `supervisord` éƒ½æ˜¯ç”¨äºç®¡ç†å’Œç›‘æ§ç³»ç»ŸæœåŠ¡çš„å·¥å…·ï¼Œä½†å®ƒä»¬æœ‰ä¸åŒçš„è®¾è®¡ç›®æ ‡ã€åŠŸèƒ½é›†å’Œä½¿ç”¨åœºæ™¯ã€‚

**åœ¨åŠŸèƒ½ç”¨é€”ä¸Šï¼š**

* **`systemd`**ï¼š

  - æ˜¯ **Linux ç³»ç»Ÿçš„åˆå§‹åŒ–ç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†å™¨**ï¼Œä¸ä»…ç”¨äºå¯åŠ¨å’Œç®¡ç†ç³»ç»ŸæœåŠ¡ï¼Œè¿˜ç®¡ç†ç³»ç»Ÿçš„æ•´ä½“å¯åŠ¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ç”¨æˆ·ä¼šè¯ã€ç¡¬ä»¶è®¾å¤‡ã€ç½‘ç»œæœåŠ¡ç­‰ã€‚

  - å®ƒè´Ÿè´£å¤„ç†ç³»ç»Ÿçº§åˆ«çš„æœåŠ¡ã€è¿›ç¨‹ã€ç¡¬ä»¶è®¾å¤‡ã€æ—¥å¿—ç®¡ç†ç­‰ã€‚å…¶æ ¸å¿ƒåŠŸèƒ½è¿œè¶…è¿›ç¨‹ç›‘æ§å’Œç®¡ç†ã€‚

  - **è·¨è¶Šå¤šä¸ªè¿›ç¨‹çš„ç®¡ç†**ï¼š`systemd` å¯ä»¥ç®¡ç†ä¾èµ–å…³ç³»ã€ç³»ç»Ÿå¯åŠ¨é¡ºåºç­‰ï¼Œé€‚ç”¨äºå¤æ‚çš„å¤šè¿›ç¨‹æœåŠ¡ã€‚

  - æä¾›ä¸°å¯Œçš„æœåŠ¡ç®¡ç†é€‰é¡¹ï¼Œå¦‚æ—¥å¿—æ”¶é›†ã€èµ„æºé™åˆ¶ã€è¿›ç¨‹ä¼˜å…ˆçº§æ§åˆ¶ç­‰ã€‚

* **`supervisor`**ï¼š

  - æ˜¯ä¸€ä¸ª **è¿›ç¨‹æ§åˆ¶ç³»ç»Ÿ**ï¼Œä¸“æ³¨äºç®¡ç†åå°è¿›ç¨‹ï¼ˆé€šå¸¸æ˜¯ç”¨æˆ·çº§åˆ«çš„è¿›ç¨‹ï¼‰ã€‚

  - å®ƒé€‚ç”¨äºç›‘æ§å’Œé‡å¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå°¤å…¶åœ¨åº”ç”¨ç¨‹åºéœ€è¦é«˜åº¦æ§åˆ¶çš„åœºæ™¯ä¸­ï¼ˆä¾‹å¦‚ Web åº”ç”¨ã€åå°æœåŠ¡ï¼‰ã€‚

  - **è¿›ç¨‹ç›‘æ§å’Œè‡ªåŠ¨é‡å¯**ï¼š`supervisor` å¯ä»¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯è¿›ç¨‹ï¼Œå¹¶ç›‘æ§å®ƒä»¬çš„çŠ¶æ€ã€‚

  - ä¸æ¶‰åŠç³»ç»Ÿåˆå§‹åŒ–ã€ç¡¬ä»¶ç®¡ç†ç­‰ä½çº§ä»»åŠ¡ã€‚

**åœ¨é€‚ç”¨åœºæ™¯ä¸Šï¼š**

* **`systemd`**ï¼š

  - ç”¨äº **æ“ä½œç³»ç»Ÿçº§åˆ«çš„æœåŠ¡ç®¡ç†**ï¼Œé€‚åˆç®¡ç†ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­çš„æ‰€æœ‰æœåŠ¡ï¼Œæ¶µç›–åº•å±‚å’Œåº”ç”¨çº§åˆ«çš„è¿›ç¨‹ç®¡ç†ã€‚

  - **é€‚ç”¨èŒƒå›´**å¹¿æ³›ï¼Œä¸ä»…é€‚åˆè¿›ç¨‹ç›‘æ§ï¼Œè¿˜ç”¨äºç®¡ç†ç½‘ç»œã€ç¡¬ä»¶ã€ç”¨æˆ·ä¼šè¯ç­‰ç³»ç»Ÿèµ„æºã€‚

  - `systemd` æä¾›çš„ **æœåŠ¡ç®¡ç†åŠŸèƒ½**æ›´åŠ å¼ºå¤§å’Œç»†ç²’åº¦ï¼Œé€‚ç”¨äºéœ€è¦è·¨æœåŠ¡çš„ä¾èµ–ç®¡ç†å’Œå¯åŠ¨é¡ºåºçš„å¤æ‚ç³»ç»Ÿã€‚

* **`supervisor`**ï¼š

  - é€‚ç”¨äº **ç”¨æˆ·çº§çš„åå°è¿›ç¨‹ç›‘æ§**ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¿«é€Ÿéƒ¨ç½²å’Œæ§åˆ¶å¤šä¸ªåº”ç”¨è¿›ç¨‹æ—¶ã€‚

  - **è¿›ç¨‹ç®¡ç†å’Œè‡ªåŠ¨é‡å¯**åŠŸèƒ½è¾ƒä¸ºç®€æ´ã€æ˜“äºé…ç½®ï¼Œéå¸¸é€‚åˆå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦ç›‘æ§çš„æœåŠ¡ï¼ˆå¦‚ Web åº”ç”¨ã€ä»»åŠ¡è°ƒåº¦ç­‰ï¼‰ã€‚

  - é€‚åˆ **å°è§„æ¨¡æˆ–ä¸­ç­‰è§„æ¨¡çš„åº”ç”¨ç›‘æ§**ï¼Œä¸æ¶‰åŠæ“ä½œç³»ç»Ÿçº§åˆ«çš„ç®¡ç†ã€‚

| ç‰¹æ€§             | systemd                                    | supervisor                         |
| ---------------- | ------------------------------------------ | ---------------------------------- |
| **é€‚ç”¨èŒƒå›´**     | ç³»ç»ŸæœåŠ¡ã€ç¡¬ä»¶ç®¡ç†ã€è¿›ç¨‹ç®¡ç†ç­‰             | ä¸»è¦ç”¨äºç®¡ç†ç”¨æˆ·çº§è¿›ç¨‹             |
| **é…ç½®å¤æ‚åº¦**   | é…ç½®æ–‡ä»¶è¯­æ³•å¤æ‚ï¼ŒåŠŸèƒ½å¼ºå¤§                 | é…ç½®ç®€å•ï¼Œæ˜“äºä¸Šæ‰‹                 |
| **ä¾èµ–å…³ç³»ç®¡ç†** | å¼ºå¤§çš„ä¾èµ–å…³ç³»å’Œå¯åŠ¨é¡ºåºç®¡ç†               | ä¸æ”¯æŒå¤æ‚ä¾èµ–å…³ç³»                 |
| **æ—¥å¿—ç®¡ç†**     | å†…å»ºæ—¥å¿—ç®¡ç†ï¼ˆ`journalctl`ï¼‰               | åŸºæœ¬çš„æ—¥å¿—ç®¡ç†ï¼ˆé…ç½®æ–‡ä»¶å®šä¹‰ï¼‰     |
| **èµ„æºç®¡ç†**     | æ”¯æŒCPUã€å†…å­˜ã€ç½‘ç»œç­‰èµ„æºé™åˆ¶              | èµ„æºç®¡ç†è¾ƒå¼±                       |
| **é€‚ç”¨åœºæ™¯**     | ç³»ç»ŸæœåŠ¡ã€å¤æ‚æœåŠ¡ç®¡ç†ã€éœ€è¦é«˜å¯é æ€§çš„ç¯å¢ƒ | ç®€å•è¿›ç¨‹ç›‘æ§ã€å°è§„æ¨¡åº”ç”¨ã€å¼€å‘ç¯å¢ƒ |

## supervisor

`Supervisor` æ˜¯ä¸€ä¸ªå¼€æºçš„è¿›ç¨‹ç®¡ç†å’Œç›‘æ§å·¥å…·ï¼Œä¸»è¦ç”¨äºæ§åˆ¶å’Œç®¡ç†åå°è¿›ç¨‹ã€‚å®ƒå…è®¸ç”¨æˆ·å¯åŠ¨ã€åœæ­¢ã€é‡å¯è¿›ç¨‹ï¼Œå¹¶ç›‘æ§è¿›ç¨‹çš„çŠ¶æ€ã€‚`Supervisor` æä¾›äº†ç®€å•çš„é…ç½®æ–‡ä»¶å’Œå‘½ä»¤è¡Œæ¥å£ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†ç‹¬ç«‹çš„åå°åº”ç”¨è¿›ç¨‹ï¼Œç¡®ä¿å®ƒä»¬åœ¨å´©æºƒåè‡ªåŠ¨é‡å¯ï¼Œä¸”æ˜“äºé›†æˆåˆ°åº”ç”¨ç¨‹åºçš„è¿ç»´ä¸­ã€‚

å®ƒç‰¹åˆ«é€‚ç”¨äºå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒä¸­çš„åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ç®¡ç†ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿæ§åˆ¶åº”ç”¨è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚

**æ ¸å¿ƒç»„ä»¶**

1. **`supervisord`**ï¼šæ˜¯ `Supervisor` çš„æ ¸å¿ƒå®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£å¯åŠ¨ã€åœæ­¢å’Œç›‘æ§å­è¿›ç¨‹ã€‚å®ƒé€šå¸¸ä½œä¸ºä¸€ä¸ªåå°æœåŠ¡è¿è¡Œï¼Œå¹¶ç®¡ç†ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ã€‚
2. **`supervisorctl`**ï¼šæ˜¯ `Supervisor` çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ `supervisord` è¿›ç¨‹è¿›è¡Œäº¤äº’ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡å®ƒæ¥æ§åˆ¶è¿›ç¨‹çš„å¯åŠ¨ã€åœæ­¢ã€é‡å¯å’ŒæŸ¥çœ‹è¿›ç¨‹çš„çŠ¶æ€ã€‚
3. **é…ç½®æ–‡ä»¶**ï¼š`Supervisor` çš„é…ç½®æ–‡ä»¶é€šå¸¸æ˜¯ä¸€ä¸ªç®€å•çš„æ–‡æœ¬æ–‡ä»¶ï¼ˆé»˜è®¤è·¯å¾„ `/etc/supervisord.conf`ï¼‰ï¼Œç”¨æˆ·é€šè¿‡å®ƒæ¥å®šä¹‰è¦ç®¡ç†çš„è¿›ç¨‹å’Œé…ç½®ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**

* è¿›ç¨‹ç®¡ç†ï¼šå¯ä»¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯å•ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ï¼Œæ”¯æŒåå°è¿è¡Œã€‚

* è‡ªåŠ¨é‡å¯ï¼šå½“è¢«ç›‘æ§çš„è¿›ç¨‹å´©æºƒæ—¶ï¼Œ`Supervisor` ä¼šè‡ªåŠ¨å°è¯•é‡æ–°å¯åŠ¨å®ƒã€‚

* è¿›ç¨‹æ—¥å¿—ç®¡ç†ï¼šå¯ä»¥æŒ‡å®šæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯æ—¥å¿—çš„å­˜å‚¨è·¯å¾„ï¼Œæ–¹ä¾¿æ—¥å¿—ç®¡ç†å’Œè°ƒè¯•ã€‚

* è¿›ç¨‹ç»„ç®¡ç†ï¼šæ”¯æŒç®¡ç†ä¸€ç»„è¿›ç¨‹ï¼Œé€šè¿‡ä¸€ä¸ªå‘½ä»¤åŒæ—¶å¯åŠ¨ã€åœæ­¢æˆ–é‡å¯å¤šä¸ªè¿›ç¨‹ã€‚

* å®æ—¶ç›‘æ§ï¼šå¯ä»¥é€šè¿‡ `supervisorctl` æŸ¥çœ‹è¿›ç¨‹çš„çŠ¶æ€ï¼Œç¡®è®¤å“ªäº›è¿›ç¨‹åœ¨è¿è¡Œï¼Œå“ªäº›è¿›ç¨‹åœæ­¢æˆ–å´©æºƒã€‚

### å®‰è£…

> ä½¿ç”¨åŒ…ç®¡ç†å™¨å®‰è£…

<code-group>
  <code-block title="Debian/Ubuntu" active>

```bash
sudo apt-get install supervisor
```

  </code-block>

  <code-block title="CentOS/RHEL">

```bash
sudo yum install supervisor
```

  </code-block>

<code-block title="pip">

```bash
pip install supervisor
```

</code-block>

</code-group>

::: tip
æœ¬æ–‡ä¸»è¦ä»‹ç»ç¼–è¯‘å®‰è£…çš„æ–¹å¼
:::

**æ— ç½‘ç¯å¢ƒç¼–è¯‘å®‰è£…**

å†…ç½‘å®‰è£…å¯ä»¥ä¸‹è½½ tar åŒ…æœ¬æœºç¼–è¯‘å®‰è£…

1. å‡†å¤‡å·¥ä½œ

   **ä»æœ‰ç½‘ç»œç¯å¢ƒä¸­ä¸‹è½½ `Supervisor` çš„æºç åŒ…**ï¼š ä½ å¯ä»¥ä» `Supervisor` çš„å®˜æ–¹ç½‘ç«™æˆ– GitHub ä»“åº“ä¸­ä¸‹è½½æºç åŒ…ã€‚ä¸‹è½½ `tar.gz` æ–‡ä»¶ã€‚ç„¶åï¼Œå°†ä¸‹è½½çš„ `tar.gz` æ–‡ä»¶ä¼ è¾“åˆ°æ— ç½‘ç»œç¯å¢ƒçš„æœºå™¨ä¸Š

   **ç¡®ä¿æ— ç½‘ç»œç¯å¢ƒä¸‹æœ‰å¿…è¦çš„ä¾èµ–**ï¼š åœ¨ç¼–è¯‘ `Supervisor` ä¹‹å‰ï¼Œç›®æ ‡æœºå™¨éœ€è¦å®‰è£…ä¸€äº›å¼€å‘å·¥å…·å’Œä¾èµ–åŒ…ï¼Œæ¯”å¦‚ `Python` å’Œ `setuptools`ã€`pip`ç­‰ã€‚

2. å®‰è£…

   ```bash
   [root@test soft]# ls
   supervisor-4.2.5.tar.gz
   [root@test soft]# tar zxf supervisor-4.2.5.tar.gz 
   [root@test soft]# cd supervisor-4.2.5/
   [root@test supervisor-4.2.5]# python setup.py install
   ```

   å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œ`Supervisor` å°†è¢«å®‰è£…åˆ°ç³»ç»Ÿçš„ Python åº“è·¯å¾„ä¸­ã€‚

3. é…ç½®å’Œå¯åŠ¨supervisor

   1. åˆ›å»ºé…ç½®æ–‡ä»¶ï¼šå®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥åˆ›å»º `supervisord` çš„é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸åœ¨ `/etc/supervisord.conf` æˆ– `/etc/supervisor/supervisord.conf`ï¼‰ã€‚

      è¿™é‡Œæˆ‘ä¸å®˜æ–¹å»ºè®®çš„ä¸åŒï¼š

      ```bash
      mkdir -p /utxt/soft/supervisor
      ```

      åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º`conf`å’Œ`log`ä¸¤ä¸ªç›®å½•ï¼Œ`conf`ç”¨äºå­˜æ”¾ç®¡ç†è¿›ç¨‹çš„é…ç½®ï¼Œ`log`ç”¨äºå­˜æ”¾ç®¡ç†è¿›ç¨‹çš„æ—¥å¿—ã€‚

      ```bash
      cd /utxt/soft/supervisor/
      [root@test supervisor]# mkdir conf log
      [root@test supervisor]# ls
      conf  log
      ```

      åˆ›å»ºä¸€ä¸ªä¸»é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨`include`æŒ‡ä»¤åŠ è½½å…¶ä»–é…ç½®æ–‡ä»¶ï¼š

      ```bash
      vim /utxt/soft/supervisor/supervisord.conf
      ```

      ```ini
      [unix_http_server]
      file = /var/run/supervisor/supervisor.sock
      
      # å¯ä»¥è®¾ç½®webç•Œé¢ï¼Œä¸è¿‡ä¸å¸¸ç”¨
      [inet_http_server]
      #å¯ç”¨ HTTP æœåŠ¡ï¼Œç›‘å¬æŸä¸ªç«¯å£ï¼ˆä¾‹å¦‚ 9001ï¼‰
      port = 127.0.0.1:9001
      # è®¾ç½® Web UI çš„ç”¨æˆ·åå’Œå¯†ç ï¼ˆå¯é€‰ï¼‰
      username = admin
      password = yourpassword
      
      [supervisord]
      logfile=/var/log/supervisord.log
      pidfile=/var/run/supervisord.pid
      
      ; å®šä¹‰RPCæ¥å£
      [rpcinterface:supervisor]
      supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface
      
      
      [supervisorctl]
      serverurl=unix:///var/run/supervisor/supervisor.sock
      
      # é€šè¿‡ include åŠ è½½æ‰€æœ‰çš„ç¨‹åºé…ç½®
      [include]
      files = /utxt/soft/supervisor/conf/*.conf
      ```

      ```bash
      # æå‰åˆ›å»ºæ–‡ä»¶å¤¹
      sudo mkdir -m 777 /var/run/supervisor
      sudo mkdir -m 777 /var/log/supervisor
      # åˆ›å»ºsockæ–‡ä»¶
      sudo touch /var/run/supervisor/supervisor.sock
      sudo chmod 777 /var/run/supervisor/supervisor.sock
      ```

      

   2. supervisord å¯åŠ¨ï¼

      ```bash
      [root@test supervisor]# supervisord -c /utxt/soft/supervisor/supervisord.conf
      Unlinking stale socket /var/run/supervisor/supervisor.sock
      
      [root@test supervisor]# ps -ef|grep supervisord
      root       10621       1  0 12:55 ?        00:00:00 /usr/bin/python /usr/local/bin/supervisord -c /utxt/soft/supervisor/supervisord.conf
      ```

   3. ï¼ˆå¯é€‰ï¼‰è®¾ç½® Supervisor å¼€æœºå¯åŠ¨

      å¯¹äºåŸºäº `systemd` çš„ç³»ç»Ÿï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª `systemd` æœåŠ¡å•å…ƒæ¥å¯åŠ¨ `supervisord`

      ```bash
      vim /etc/systemd/system/supervisord.service
      
      [Unit]
      Description=Supervisor
      After=network.target
      
      [Service]
      ExecStart=/usr/local/bin/supervisord -c /utxt/soft/supervisor/supervisord.conf
      ExecStop=/usr/local/bin/supervisorctl shutdown
      Restart=always
      User=root
      
      [Install]
      WantedBy=multi-user.target
      ```

      é‡æ–°åŠ è½½ `systemd` é…ç½®å¹¶å¯åŠ¨æœåŠ¡ï¼š

      ```bash
      sudo systemctl daemon-reload
      sudo systemctl enable supervisord
      sudo systemctl start supervisord
      ```

      æŸ¥çœ‹æ˜¯å¦ç”Ÿæ•ˆï¼š

      ```bash
      [root@test supervisor]# sudo systemctl status supervisord
      â— supervisord.service - Supervisor
           Loaded: loaded (/etc/systemd/system/supervisord.service; enabled; preset: disabled)
           Active: active (running) since Sat 2024-12-07 13:09:32 CST; 1s ago
         Main PID: 10990 (supervisord)
            Tasks: 1 (limit: 10882)
           Memory: 15.9M
              CPU: 106ms
           CGroup: /system.slice/supervisord.service
                   â””â”€10990 /usr/bin/python /usr/local/bin/supervisord -c /utxt/soft/supervisor/supervisord.conf
      ```

      

### å¿«é€Ÿä¸Šæ‰‹

è¿›å…¥åˆ°`/utxt/soft/supervisor/conf/`ç›®å½•ï¼Œåˆ›å»ºç®¡ç†åº”ç”¨çš„é…ç½®ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªåº”ç”¨é…ç½®ã€‚

ä¾‹å¦‚ï¼Œä½¿ç”¨ supervisor ç®¡ç†ç¨‹åº `process1`:

`vim /utxt/soft/supervisor/conf/process1.conf`

```ini
[program:process1]
directory=/root			; ç¨‹åºçš„å¯åŠ¨ç›®å½•
command=/root/process1  ; å¯åŠ¨å‘½ä»¤ï¼Œä¸å‘½ä»¤è¡Œå¯åŠ¨çš„å‘½ä»¤æ˜¯ä¸€æ ·çš„
user=root               ; ç”¨å“ªä¸ªç”¨æˆ·å¯åŠ¨
autostart = true        ; ç¨‹åºæ˜¯å¦éš supervisord å¯åŠ¨
startsecs = 5			; å¯åŠ¨ 5 ç§’åæ²¡æœ‰å¼‚å¸¸é€€å‡ºï¼Œå°±å½“ä½œå·²ç»æ­£å¸¸å¯åŠ¨äº†
autorestart=true        ; ç¨‹åºå´©æºƒåæ˜¯å¦è‡ªåŠ¨é‡å¯
startretries=3			; å¯åŠ¨å¤±è´¥åé‡è¯•æ¬¡æ•°
stderr_logfile=/utxt/soft/supervisor/log/process1.err.log		; stderr æ—¥å¿—æ–‡ä»¶
stdout_logfile=/utxt/soft/supervisor/log/process1.out.log		; stdout æ—¥å¿—æ–‡ä»¶
stdout_logfile_maxbytes = 1MB			; æ§åˆ¶æ ‡å‡†è¾“å‡ºæ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼Œè¶…è¿‡æ­¤å€¼ä¼šè¿›è¡Œæ—¥å¿—è½®æ¢
stdout_logfile_backups = 10				; è®¾ç½®æ—¥å¿—è½®æ¢å¤‡ä»½æ•°é‡
stderr_logfile_maxbytes=1MB				; æ§åˆ¶æ ‡å‡†é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„å¤§å°
stderr_logfile_backups=10				; è®¾ç½®é”™è¯¯æ—¥å¿—è½®æ¢å¤‡ä»½æ•°é‡						
```

ç”Ÿæ•ˆï¼š

```bash
# supervisorctl update
Restarted supervisord
# supervisorctl status
process1                         RUNNING   pid 12621, uptime 0:00:08
```

æŸ¥çœ‹ç¨‹åºæ˜¯å¦èƒ½è‡ªåŠ¨é‡å¯ï¼š

```bash
[root@test]# ps -ef|grep process1
root       12654   12436  0 15:26 ?        00:00:00 /root/process1

[root@test]# kill -9 12654

# ç¨‹åºè¢«è‡ªåŠ¨æ‹‰èµ·äº†
[root@test]# ps -ef|grep process1
root       12670   12436  0 15:31 ?        00:00:00 /root/process1
```

`supervisord` åœ¨ç¨‹åºå´©æºƒåä¼šç«‹å³å°è¯•é‡å¯ï¼ˆé€šå¸¸åœ¨å‡ ç§’é’Ÿå†…ï¼‰ï¼Œå…·ä½“çš„é‡å¯é—´éš”é€šå¸¸ä¾èµ–äºæ“ä½œç³»ç»Ÿå’Œç¨‹åºçš„å¯åŠ¨é€Ÿåº¦ã€‚

å¦‚æœå¼€å¯äº†web uiï¼Œä¹Ÿå¯ä»¥åœ¨webä¸ŠæŸ¥çœ‹ï¼š

![image-20241207154449079](http://cdn.zhouchuang.site/img/image-20241207154449079.png)

### é…ç½®æ–‡ä»¶

ä¸‹é¢ï¼Œæˆ‘å°†è¯¦ç»†ä»‹ç» `supervisord.conf` çš„æ¯ä¸ªéƒ¨åˆ†ï¼Œå¹¶è§£é‡Šå¦‚ä½•ä¸ºä¸åŒçš„ç”¨ä¾‹é…ç½®å®ƒã€‚

1. **å…¨å±€é…ç½®éƒ¨åˆ†** ([supervisord])

   è¿™ä¸ªéƒ¨åˆ†åŒ…å«äº†ä¸ `supervisord` æœ¬èº«çš„è¿è¡Œæœ‰å…³çš„é…ç½®é¡¹ã€‚å®ƒæ˜¯æ•´ä¸ª `supervisord.conf` æ–‡ä»¶çš„é¡¶éƒ¨éƒ¨åˆ†ã€‚

   å¸¸ç”¨çš„å…¨å±€é…ç½®é¡¹ï¼š

   ```ini
   [supervisord]
   logfile=/var/log/supervisord.log        ; æŒ‡å®šæ—¥å¿—æ–‡ä»¶è·¯å¾„
   logfile_maxbytes=50MB                   ; æ—¥å¿—æ–‡ä»¶å¤§å°é™åˆ¶ï¼Œè¾¾åˆ°æ­¤é™åˆ¶æ—¶ä¼šè½®æ¢æ—¥å¿—
   logfile_backups=10                      ; æ—¥å¿—æ–‡ä»¶å¤‡ä»½æ•°é‡
   loglevel=info                           ; æ—¥å¿—çº§åˆ«ï¼ˆinfo, debug, warn, errorï¼‰
   pidfile=/var/run/supervisord.pid        ; æŒ‡å®š PID æ–‡ä»¶è·¯å¾„
   nodaemon=false                          ; æ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œï¼Œfalse ä¸ºåå°è¿è¡Œï¼Œtrue ä¸ºå‰å°
   minfds=1024                             ; ç³»ç»Ÿæœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°
   minprocs=200                            ; ç³»ç»Ÿæœ€å¤§è¿›ç¨‹æ•°
   user=nobody                             ; æŒ‡å®šè¿è¡Œ supervisord è¿›ç¨‹çš„ç”¨æˆ·ï¼ˆé¿å… root æƒé™ï¼‰
   identifier=supervisor                   ; supervisord çš„æ ‡è¯†ç¬¦ï¼Œç”¨äºä¸å…¶ä»– `supervisord` å®ä¾‹åŒºåˆ†
   directory=/tmp                          ; æŒ‡å®š `supervisord` è¿›ç¨‹çš„å·¥ä½œç›®å½•
   umask=022                               ; è®¾ç½®æ–‡ä»¶æƒé™æ©ç 
   childlogdir=/var/log/supervisor         ; ç¨‹åºçš„æ—¥å¿—æ–‡ä»¶ç›®å½•
   ```

2. **ç¨‹åºé…ç½®éƒ¨åˆ†** ([program:xxx])

   `[program:xxx]` å—ç”¨äºå®šä¹‰éœ€è¦ç”± `supervisord` ç®¡ç†çš„å•ä¸ªç¨‹åºæˆ–è¿›ç¨‹ã€‚æ¯ä¸ªç¨‹åºé…ç½®éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒåŒ…å«å¯åŠ¨ã€åœæ­¢ã€æ—¥å¿—å’Œé‡å¯ç­–ç•¥ç­‰å†…å®¹ã€‚

   ```ini
   [program:my_program]                     ; ç¨‹åºçš„æ ‡è¯†ç¬¦
   command=/path/to/your/program            ; å¯åŠ¨ç¨‹åºçš„å‘½ä»¤ï¼ˆå¿…é¡»æ˜¯å®Œæ•´çš„å‘½ä»¤æˆ–å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ï¼‰
   autostart=true                           ; å½“ supervisord å¯åŠ¨æ—¶ï¼Œæ˜¯å¦è‡ªåŠ¨å¯åŠ¨æ­¤ç¨‹åºï¼ˆé»˜è®¤ trueï¼‰
   autorestart=true                         ; ç¨‹åºå´©æºƒåæ˜¯å¦è‡ªåŠ¨é‡å¯ï¼ˆé»˜è®¤ trueï¼‰
   startretries=3                           ; ç¨‹åºå¯åŠ¨å¤±è´¥åé‡è¯•æ¬¡æ•°
   exitcodes=0,2                            ; å®šä¹‰å“ªäº›é€€å‡ºç è®¤ä¸ºæ˜¯æ­£å¸¸é€€å‡ºï¼ˆé»˜è®¤ä¸º 0ï¼‰
   stopasgroup=true                         ; åœæ­¢è¿›ç¨‹æ—¶æ˜¯å¦å‘é€ä¿¡å·ç»™è¿›ç¨‹ç»„ï¼ˆé»˜è®¤ä¸º falseï¼‰
   stopwaitsecs=10                          ; åœæ­¢è¿›ç¨‹æ—¶çš„ç­‰å¾…æ—¶é—´ï¼ˆé»˜è®¤ä¸º 10 ç§’ï¼‰
   user=nobody                              ; æŒ‡å®šç¨‹åºä»¥å“ªä¸ªç”¨æˆ·èº«ä»½è¿è¡Œ
   group=group_name                         ; æŒ‡å®šç¨‹åºçš„è¿è¡Œç»„
   priority=999                             ; è®¾ç½®è¿›ç¨‹å¯åŠ¨é¡ºåºï¼Œè¾ƒå°çš„æ•°å­—ä¼˜å…ˆå¯åŠ¨ï¼ˆé»˜è®¤ä¸º 999ï¼‰
   environment=VAR1=value1,VAR2=value2      ; è®¾ç½®ç¨‹åºçš„ç¯å¢ƒå˜é‡
   directory=/path/to/working/dir           ; è®¾ç½®ç¨‹åºçš„å·¥ä½œç›®å½•
   killasgroup=true						 ; æ§åˆ¶åœ¨ç»ˆæ­¢è¿›ç¨‹æ—¶ï¼Œæ˜¯å¦åŒæ—¶ç»ˆæ­¢è¿›ç¨‹ç»„ä¸­çš„æ‰€æœ‰å­è¿›ç¨‹
   stopasgroup=true                         ; æ§åˆ¶æ˜¯å¦åœ¨åœæ­¢è¿›ç¨‹æ—¶ï¼ŒæŠŠæ‰€æœ‰å­è¿›ç¨‹ä¹Ÿä¸€èµ·ä½œä¸ºç»„æ¥åœæ­¢ã€‚
   stdout_logfile=/var/log/my_program.log   ; ç¨‹åºçš„æ ‡å‡†è¾“å‡ºæ—¥å¿—æ–‡ä»¶è·¯å¾„
   stderr_logfile=/var/log/my_program.err   ; ç¨‹åºçš„æ ‡å‡†é”™è¯¯æ—¥å¿—æ–‡ä»¶è·¯å¾„
   stdout_logfile_maxbytes=1MB              ; æ§åˆ¶æ ‡å‡†è¾“å‡ºæ—¥å¿—æ–‡ä»¶çš„å¤§å°ï¼Œè¶…è¿‡æ­¤å€¼ä¼šè¿›è¡Œæ—¥å¿—è½®æ¢
   stdout_logfile_backups=10                ; è®¾ç½®æ—¥å¿—è½®æ¢å¤‡ä»½æ•°é‡
   stderr_logfile_maxbytes=1MB              ; æ§åˆ¶æ ‡å‡†é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„å¤§å°
   stderr_logfile_backups=10                ; è®¾ç½®æ—¥å¿—è½®æ¢å¤‡ä»½æ•°é‡
   loglevel=info                            ; æ—¥å¿—çº§åˆ«ï¼Œæ§åˆ¶æ—¥å¿—è®°å½•çš„è¯¦ç»†ç¨‹åº¦
   
   redirect_stderr = true  ; æŠŠstderré‡å®šå‘åˆ°stdout,é»˜è®¤ false,è¿™æ ·å°±å¯ä»¥åªè¾“å‡ºåˆ°stdoutä¸­
   ```

   å…¶ä¸­æ³¨æ„ä¸¤é¡¹ï¼š

   `killasgroup=`

   * å½“ `killasgroup=true` æ—¶ï¼Œåœæ­¢ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼ŒSupervisor ä¼šå°è¯•æ€æ­»è¯¥è¿›ç¨‹çš„æ‰€æœ‰å­è¿›ç¨‹ï¼ˆå¦‚æœè¯¥è¿›ç¨‹æœ‰å­è¿›ç¨‹ï¼‰ã€‚è¿™å¯¹äºç®¡ç†éœ€è¦æ§åˆ¶çˆ¶å­è¿›ç¨‹å…³ç³»çš„åº”ç”¨éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ï¼Œåœ¨å¤šè¿›ç¨‹çš„åº”ç”¨ä¸­ï¼Œéœ€è¦ç¡®ä¿ä¸»è¿›ç¨‹åŠå…¶æ‰€æœ‰å­è¿›ç¨‹éƒ½èƒ½è¢«ä¸€èµ·åœæ­¢ã€‚
   * å½“ `killasgroup=false`ï¼ˆé»˜è®¤å€¼ï¼‰æ—¶ï¼Œåœæ­¢ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œåªä¼šç»ˆæ­¢è¯¥è¿›ç¨‹æœ¬èº«ï¼Œè€Œä¸ä¼šç»ˆæ­¢å…¶å­è¿›ç¨‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­è¿›ç¨‹ä¼šç»§ç»­è¿è¡Œï¼Œç›´åˆ°å®ƒä»¬è¢«å•ç‹¬åœæ­¢ã€‚å­è¿›ç¨‹ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ğŸ§Ÿâ€â™€ï¸ã€‚

   `stopasgroup=`

   * å½“ `stopasgroup=true` æ—¶ï¼Œåœæ­¢ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼ŒSupervisor ä¼šå°†å…¶è§†ä¸ºä¸€ä¸ªâ€œè¿›ç¨‹ç»„â€ï¼Œå¹¶ä¸”ä¼šç»ˆæ­¢æ‰€æœ‰ä¸è¯¥è¿›ç¨‹ç›¸å…³è”çš„å­è¿›ç¨‹ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªé…ç½®è®©è¿›ç¨‹åŠå…¶æ‰€æœ‰å­è¿›ç¨‹åƒä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ä¸€æ ·æ¥åœæ­¢ã€‚

   * å½“ `stopasgroup=false`ï¼ˆé»˜è®¤å€¼ï¼‰æ—¶ï¼ŒSupervisor åªä¼šåœæ­¢ä¸»è¿›ç¨‹ï¼Œè€Œä¸ä¼šåœæ­¢å…¶å­è¿›ç¨‹ã€‚å­è¿›ç¨‹å¦‚æœéœ€è¦åœæ­¢ï¼Œåˆ™å¿…é¡»å•ç‹¬è¿›è¡Œæ§åˆ¶ã€‚

3. **è¿›ç¨‹ç»„é…ç½®éƒ¨åˆ†** ([group:xxx])

   `[group:xxx]` å…è®¸å°†å¤šä¸ªç¨‹åºå½’ç±»åœ¨ä¸€èµ·ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚å½“ä½ å¸Œæœ›ä¸€æ¬¡æ€§å¯åŠ¨æˆ–åœæ­¢å¤šä¸ªç¨‹åºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨è¿›ç¨‹ç»„ã€‚

   ç¤ºä¾‹ï¼š

   ```ini
   [group:my_group]
   programs=my_program1,my_program2
   ```

   æ­¤é…ç½®æŒ‡å®šäº†ä¸€ä¸ªè¿›ç¨‹ç»„ `my_group`ï¼Œå…¶ä¸­åŒ…æ‹¬ `my_program1` å’Œ `my_program2`ã€‚ä½ å¯ä»¥ä½¿ç”¨ `supervisorctl` æ¥ä¸€èµ·å¯åŠ¨æˆ–åœæ­¢æ•´ä¸ªç»„ï¼š

   ```bash
   sudo supervisorctl start my_group
   ```

4. **åŒ…å«å¤–éƒ¨é…ç½®æ–‡ä»¶** (`[include]`)

   `[include]` ç”¨äºåœ¨ä¸»é…ç½®æ–‡ä»¶ä¸­åŒ…å«å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œè¿™å¯¹äºç»„ç»‡å¤§å‹é…ç½®æ–‡ä»¶æˆ–åŠ¨æ€åŠ è½½å¤šä¸ªç¨‹åºé…ç½®éå¸¸æœ‰ç”¨ã€‚ä½ å¯ä»¥ä½¿ç”¨é€šé…ç¬¦æ¥æ‰¹é‡åŠ è½½é…ç½®æ–‡ä»¶ã€‚

   ```ini
   [include]
   files = /etc/supervisor/conf.d/*.conf
   ```

   è¿™è¡¨ç¤ºå°† `/etc/supervisor/conf.d/` ç›®å½•ä¸‹çš„æ‰€æœ‰ `.conf` æ–‡ä»¶åŠ è½½åˆ°ä¸»é…ç½®æ–‡ä»¶ä¸­ã€‚

5. **web ui é…ç½®éƒ¨åˆ†** (`[inet_http_server]`)

   `[inet_http_server]` éƒ¨åˆ†é…ç½®äº†é€šè¿‡ HTTP è¿›è¡Œè¿œç¨‹æ§åˆ¶å’ŒæŸ¥çœ‹ç¨‹åºçŠ¶æ€çš„åŠŸèƒ½ã€‚å®ƒå…è®¸é€šè¿‡ Web ç•Œé¢æˆ–å‘½ä»¤è¡Œå·¥å…·ä¸ `supervisord` è¿›è¡Œäº¤äº’ã€‚

   ```ini
   [inet_http_server]
   port=127.0.0.1:9001            ; ç›‘å¬ç«¯å£ï¼Œæ”¯æŒ TCP/IP å’Œ Unix åŸŸå¥—æ¥å­—
   username=user                  ; ç”¨æˆ·å
   password=pass                  ; å¯†ç 
   ```

   è®¾ç½®åï¼Œä½ å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® `http://127.0.0.1:9001` æ¥æŸ¥çœ‹å¹¶æ§åˆ¶ `supervisord` ç®¡ç†çš„ç¨‹åºã€‚

6. **è­¦å‘Šå’Œä¿¡å·éƒ¨åˆ†** (`[supervisorctl]`)

   `[supervisorctl]` éƒ¨åˆ†ç”¨äºé…ç½® `supervisorctl` å‘½ä»¤è¡Œå·¥å…·çš„è¡Œä¸ºã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿æ¥åˆ° `supervisord` è¿›ç¨‹æ—¶çš„ä¸€äº›é€‰é¡¹ï¼Œå¦‚æ˜¯å¦å¯ç”¨ UNIX åŸŸå¥—æ¥å­—ã€‚

   ```ini
   [supervisorctl]
   serverurl=unix:///var/run/supervisord.sock   ; ä½¿ç”¨ UNIX å¥—æ¥å­—è¿›è¡Œé€šä¿¡
   ```

7. **è¿›ç¨‹é™åˆ¶éƒ¨åˆ†** (`[processcontrol]`)

   è¿™ä¸ªéƒ¨åˆ†æ§åˆ¶ `supervisord` åœ¨å¯åŠ¨ã€åœæ­¢æˆ–é‡æ–°å¯åŠ¨è¿›ç¨‹æ—¶å¦‚ä½•ç®¡ç†è¿›ç¨‹ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ§åˆ¶ç¨‹åºä¹‹é—´çš„å¹¶å‘æ‰§è¡Œç­‰ã€‚

   ```ini
   [processcontrol]
   maxprocs=10000                    ; é™åˆ¶æœ€å¤§è¿›ç¨‹æ•°
   ```

8. **æ—¥å¿—è½®è½¬é…ç½®**

   `supervisord` æ”¯æŒå¯¹æ—¥å¿—è¿›è¡Œè½®è½¬ï¼Œé¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§ã€‚é€šè¿‡é…ç½®æ—¥å¿—æ–‡ä»¶çš„å¤§å°é™åˆ¶ï¼Œè¶…è¿‡é™åˆ¶æ—¶è¿›è¡Œè‡ªåŠ¨è½®æ¢ã€‚

   ```ini
   stdout_logfile_maxbytes=1MB          ; æ§åˆ¶æ ‡å‡†è¾“å‡ºæ—¥å¿—æ–‡ä»¶çš„å¤§å°
   stderr_logfile_maxbytes=1MB          ; æ§åˆ¶æ ‡å‡†é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„å¤§å°
   stdout_logfile_backups=5             ; æ§åˆ¶æ ‡å‡†è¾“å‡ºæ—¥å¿—æ–‡ä»¶ä¿ç•™çš„å¤‡ä»½æ•°é‡
   stderr_logfile_backups=5             ; æ§åˆ¶æ ‡å‡†é”™è¯¯æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„å¤‡ä»½æ•°é‡
   ```

### supervisorctl

`supervisorctl` æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºä¸ `supervisord` å®ˆæŠ¤è¿›ç¨‹è¿›è¡Œäº¤äº’ï¼Œç®¡ç†æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚`supervisord` æ˜¯ä¸€ä¸ªè¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¯ä»¥ç”¨æ¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€æŸ¥çœ‹æ—¥å¿—å’Œè·å–è¿›ç¨‹çŠ¶æ€ã€‚`supervisorctl` å…è®¸ç”¨æˆ·é€šè¿‡å‘½ä»¤è¡Œå¯¹è¿™äº›æ“ä½œè¿›è¡Œæ§åˆ¶ã€‚

#### å¸¸ç”¨å‘½ä»¤

1. **å¯åŠ¨è¿›ç¨‹**

   - `start`ï¼šå¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ã€‚

   ```bash
   supervisorctl start <program_name>
   
   # å¯åŠ¨æ‰€æœ‰è¿›ç¨‹
   supervisorctl start all
   ```

2. åœæ­¢è¿›ç¨‹

   - `stop`ï¼šåœæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ã€‚

   ```bash
   supervisorctl stop <program_name>
   
   # åœæ­¢æ‰€æœ‰è¿›ç¨‹
   supervisorctl stop all
   ```

3. é‡å¯è¿›ç¨‹

   - `restart`ï¼šé‡å¯ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ã€‚

   ```bash
   supervisorctl restart <program_name>
   ```

4. æŸ¥çœ‹è¿›ç¨‹çŠ¶æ€

   - `status`ï¼šæŸ¥çœ‹ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹çš„å½“å‰çŠ¶æ€ã€‚

   ```bash
   # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
   supervisorctl status
   
   # æŸ¥çœ‹æŒ‡å®šç¨‹åºçš„çŠ¶æ€
   supervisorctl status <program_name>
   ```

5. é‡æ–°åŠ è½½é…ç½®

   * `reload`ï¼šé‡æ–°åŠ è½½ `supervisord` é…ç½®æ–‡ä»¶ï¼ˆé‡æ–°å¯åŠ¨é…ç½®ä¸­çš„æ‰€æœ‰ç¨‹åºï¼‰ã€‚
   * âš ï¸ ç”Ÿäº§ç¯å¢ƒæ…ç”¨ï¼šå¯èƒ½ä¼šé‡å¯æ‰€æœ‰çš„ç¨‹åºã€‚

   ```bash
   supervisorctl reload
   ```

6. é‡æ–°è¯»å–é…ç½®æ–‡ä»¶

   * `reread`ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶
   * **é‡æ–°åŠ è½½é…ç½®**ï¼š`reread` å‘½ä»¤ä¼šè®© Supervisor é‡æ–°è¯»å–å…¶é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ `supervisord.conf` åŠå…¶åŒ…å«çš„å…¶ä»–é…ç½®æ–‡ä»¶ï¼‰ï¼Œä½†ä¸ä¼šç«‹å³åº”ç”¨è¿™äº›é…ç½®ã€‚
   * **æ›´æ–°é…ç½®è€Œä¸é‡å¯è¿›ç¨‹**ï¼šä¸ `reload` å‘½ä»¤ä¸åŒï¼Œ`reread` åªæ›´æ–° Supervisor çš„å†…éƒ¨é…ç½®ï¼Œä¸ä¼šå½±å“æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚è¿™æ„å‘³ç€å®ƒä¸ä¼šå¯åŠ¨ã€åœæ­¢æˆ–é‡å¯ä»»ä½•è¿›ç¨‹ã€‚
   * **å‡†å¤‡æ›´æ–°**ï¼š`reread` å‘½ä»¤é€šå¸¸ç”¨äºåœ¨åº”ç”¨é…ç½®æ›´æ”¹ä¹‹å‰å…ˆé¢„å…ˆè¯»å–é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿é…ç½®æ–‡ä»¶è¯­æ³•æ­£ç¡®ã€‚å¦‚æœé…ç½®æ–‡ä»¶æœ‰è¯­æ³•é”™è¯¯ï¼Œ`reread` ä¼šæŠ¥å‘Šè¿™äº›é”™è¯¯ï¼Œé¿å…åœ¨å®é™…åº”ç”¨é…ç½®æ—¶å‡ºç°é—®é¢˜ã€‚

   ```bash
   supervisorctl reread
   ```

   é€šå¸¸ï¼Œ`reread` ä¸ `update` å‘½ä»¤ä¸€èµ·ä½¿ç”¨ã€‚å…ˆä½¿ç”¨ `reread` æ£€æŸ¥é…ç½®æ–‡ä»¶ï¼Œç„¶åç”¨ `update` æ¥åº”ç”¨é…ç½®æ›´æ”¹ï¼š

7. é‡å¯é…ç½®æ–‡ä»¶ä¿®æ”¹è¿‡çš„ç¨‹åº

   * `update`ï¼šé‡å¯é…ç½®æ–‡ä»¶ä¿®æ”¹è¿‡çš„ç¨‹åº
   * :star2: æ¯”reloadæ›´å¸¸ç”¨ï¼Œæ›´å®ç”¨

   ```bash
   supervisorctl update
   ```

8. æŸ¥çœ‹æ—¥å¿—

- `tail`ï¼šæŸ¥çœ‹è¿›ç¨‹çš„æ—¥å¿—è¾“å‡ºã€‚

```bash
supervisorctl tail [-f] <name> [stdout|stderr] (default stdout)

# ä¾‹ï¼š
supervisorctl tail -f program_name

supervisorctl tail program_name

supervisorctl tail -f program_name stdout

supervisorctl tail -f program_name stderr

```

#### ä¸ supervisord çš„å…³ç³»

- `supervisord` æ˜¯åå°æœåŠ¡è¿›ç¨‹ï¼Œè´Ÿè´£ç®¡ç†å¤šä¸ªå­è¿›ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€‚
- `supervisorctl` æ˜¯ä¸€ä¸ªå‰ç«¯å·¥å…·ï¼Œç”¨äºä¸ `supervisord` é€šä¿¡ï¼Œé€šè¿‡ RPC æ¥å£æˆ– UNIX å¥—æ¥å­—æ¥ç®¡ç†å’Œæ§åˆ¶è¿›ç¨‹ã€‚

### æ¶æ„å›¾

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ `Supervisor` æ¶æ„å›¾æè¿°ï¼š

```mermaid
graph LR
    A[SupervisorD] -->|å¯åŠ¨| B[SupervisorCtl]
    B -->|å‘½ä»¤| C[Supervisor]
    C -->|ç®¡ç†| D[å­è¿›ç¨‹]
    C -->|ç›‘æ§| E[äº‹ä»¶ç›‘å¬å™¨]
    E -->|è§¦å‘| F[äº‹ä»¶]
    F -->|å“åº”| C
    C -->|æ—¥å¿—| G[æ—¥å¿—ç³»ç»Ÿ]
    C -->|é…ç½®| H[é…ç½®æ–‡ä»¶]
```

- **SupervisorD**: è¿™æ˜¯ Supervisor çš„å®ˆæŠ¤è¿›ç¨‹,å®ƒä¼šå¯åŠ¨å¹¶è¿è¡Œåœ¨åå°,ç®¡ç†æ‰€æœ‰çš„å­è¿›ç¨‹ã€‚
- **SupervisorCtl**: è¿™æ˜¯ Supervisor çš„æ§åˆ¶ç«¯,ç”¨æˆ·é€šè¿‡å®ƒæ¥å‘é€å‘½ä»¤ç»™ SupervisorDã€‚
- **Supervisor**: è¿™æ˜¯ Supervisor çš„æ ¸å¿ƒ,è´Ÿè´£ç®¡ç†å’Œç›‘æ§æ‰€æœ‰çš„å­è¿›ç¨‹ã€‚
- **å­è¿›ç¨‹**: è¿™äº›æ˜¯ Supervisor ç®¡ç†çš„å®é™…è¿è¡Œçš„è¿›ç¨‹æˆ–ç¨‹åºã€‚
- **äº‹ä»¶ç›‘å¬å™¨**: è¿™äº›ç»„ä»¶ç›‘å¬ Supervisor è§¦å‘çš„äº‹ä»¶,å¦‚è¿›ç¨‹çŠ¶æ€å˜åŒ–,å¹¶å¯ä»¥æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚
- **äº‹ä»¶**: ç”± Supervisor æˆ–äº‹ä»¶ç›‘å¬å™¨è§¦å‘çš„äº‹ä»¶,å¦‚è¿›ç¨‹å¯åŠ¨ã€åœæ­¢ã€å´©æºƒç­‰ã€‚
- **æ—¥å¿—ç³»ç»Ÿ**: Supervisor ä¼šå°†æ“ä½œå’Œäº‹ä»¶è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ã€‚
- **é…ç½®æ–‡ä»¶**: Supervisor çš„è¡Œä¸ºç”±é…ç½®æ–‡ä»¶å®šä¹‰,å¦‚å“ªäº›è¿›ç¨‹éœ€è¦ç®¡ç†,å¦‚ä½•ç›‘æ§ç­‰ã€‚

### èµ„æºæ¶ˆè€—

1. **å†…å­˜ä½¿ç”¨**ï¼š
   - `supervisor` æœ¬èº«ä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„è¿›ç¨‹ç®¡ç†å™¨ï¼Œé€šå¸¸ä¸ä¼šæ¶ˆè€—å¤§é‡å†…å­˜ã€‚å®ƒçš„å†…å­˜ä½¿ç”¨é‡ä¸»è¦å–å†³äºå®ƒç®¡ç†çš„è¿›ç¨‹æ•°é‡ä»¥åŠæ¯ä¸ªè¿›ç¨‹çš„å†…å­˜å ç”¨ã€‚
   - åœ¨æ²¡æœ‰ç®¡ç†ä»»ä½•è¿›ç¨‹çš„æƒ…å†µä¸‹ï¼Œ`supervisor` å¯èƒ½åªå ç”¨å‡ å…†å­—èŠ‚ï¼ˆMBï¼‰çš„å†…å­˜ã€‚
   - å½“ç®¡ç†å¤šä¸ªè¿›ç¨‹æ—¶ï¼Œ`supervisor` ä¼šä¸ºæ¯ä¸ªè¿›ç¨‹ç»´æŠ¤ä¸€ä¸ªå°é¢çš„é¢å¤–å†…å­˜å¼€é”€ï¼Œä½†è¿™é€šå¸¸æ˜¯å¾®ä¸è¶³é“çš„ã€‚
2. **CPUä½¿ç”¨**ï¼š
   - `supervisor` ä¸»è¦åœ¨å¯åŠ¨ã€åœæ­¢ã€é‡å¯è¿›ç¨‹æˆ–ç›‘æ§è¿›ç¨‹çŠ¶æ€æ—¶ä½¿ç”¨ CPUã€‚é™¤éé…ç½®äº†é¢‘ç¹çš„å¥åº·æ£€æŸ¥æˆ–äº‹ä»¶ç›‘å¬ï¼Œå¦åˆ™å®ƒçš„ CPU ä½¿ç”¨ç‡ä¸€èˆ¬è¾ƒä½ã€‚
   - å³ä½¿åœ¨ç®¡ç†å¤§é‡è¿›ç¨‹æ—¶ï¼Œ`supervisor` çš„ CPU ä½¿ç”¨ä¹Ÿä¸»è¦é›†ä¸­åœ¨è¿›ç¨‹çŠ¶æ€å˜åŒ–çš„ç¬é—´ã€‚
3. **I/Oæ“ä½œ**ï¼š
   - `supervisor` ä¼šå®šæœŸæ£€æŸ¥è¿›ç¨‹çš„çŠ¶æ€ï¼Œè¿™å¯èƒ½æ¶‰åŠä¸€äº› I/O æ“ä½œï¼Œç‰¹åˆ«æ˜¯å¦‚æœé…ç½®äº†æ—¥å¿—è½®è½¬æˆ–ç›‘æ§äº‹ä»¶ã€‚
   - æ—¥å¿—è®°å½•å’Œé…ç½®æ–‡ä»¶çš„è¯»å–/å†™å…¥ä¹Ÿä¼šäº§ç”Ÿä¸€å®šçš„ I/O æ¶ˆè€—ï¼Œä½†è¿™é€šå¸¸æ˜¯å¯æ§çš„ã€‚

## æ€»ç»“

æ€»çš„æ¥è¯´ï¼Œ`supervisor` é€šè¿‡ç®€åŒ–äº†å¤æ‚çš„è¿›ç¨‹ç®¡ç†ä»»åŠ¡ï¼Œä½¿å¾—ç³»ç»Ÿç®¡ç†å‘˜èƒ½å¤Ÿæ›´ä¸“æ³¨äºåº”ç”¨çš„å¼€å‘å’Œç»´æŠ¤ï¼Œè€Œä¸æ˜¯è¢«è¿›ç¨‹ç®¡ç†çš„ç¹çç»†èŠ‚æ‰€å›°æ‰°ã€‚æ— è®ºæ˜¯æ–°æ‰‹è¿˜æ˜¯ç»éªŒä¸°å¯Œçš„ç³»ç»Ÿç®¡ç†å‘˜ï¼ŒæŒæ¡ `supervisor` çš„ä½¿ç”¨éƒ½æ˜¯æå‡ç³»ç»Ÿç®¡ç†èƒ½åŠ›ã€ç¡®ä¿ç³»ç»Ÿç¨³å®šè¿è¡Œçš„é‡è¦ä¸€æ­¥ã€‚
