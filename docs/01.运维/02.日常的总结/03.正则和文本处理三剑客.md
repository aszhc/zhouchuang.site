---
title: æ­£åˆ™å’Œæ–‡æœ¬å¤„ç†ä¸‰å‰‘å®¢å°ç»“
date: 2024-12-27 15:29:11
permalink: /pages/b8893e/
categories:
  - è¿ç»´
  - æ—¥å¸¸çš„æ€»ç»“
tags:
  - æ­£åˆ™
  - æ–‡æœ¬å¤„ç†
  - awk
  - grep
  - sed
author: 
  name: ZhouChuang
  link: https://github.com/aszhc
---

* æ­£åˆ™è¡¨è¾¾å¼ä¸ grep
    * æ³¨æ„äº‹é¡¹
    * åŸºç¡€æ­£åˆ™ä¸å®æˆ˜
    * æ‰©å±•æ­£åˆ™ä¸å®æˆ˜

* ä¸‰å‰‘å®¢ sed



## 1. æ­£åˆ™

ğŸ“¢ æ³¨æ„äº‹é¡¹

* è‹±æ–‡å­—ç¬¦

### 1.1 ç¬¦å·æ¦‚è¿°

| æ­£åˆ™è¡¨è¾¾å¼   |                                 |
| ------------ | ------------------------------- |
| åŸºç¡€æ­£åˆ™     | `^` `$` `.` `*` `.*` `[]` `[^]` |
| æ‰©å±•æ­£åˆ™     | `|` `()` `{}` `?` `+`           |
| å…¶ä»–ç±»å‹æ­£åˆ™ |                                 |

### 1.2 åŸºç¡€æ­£åˆ™

ä¸‰å‰‘å®¢å‘½ä»¤é»˜è®¤æ”¯æŒçš„æ­£åˆ™

#### ^ ä»¥...å¼€å¤´çš„è¡Œ

![image-20240717224125380](http://cdn.zhouchuang.site/img/20240717224127.png)

#### $ ä»¥...ç»“å°¾çš„è¡Œ

* ä»¥æ•°å­— 6 ç»“å°¾

  ![image-20240717224309647](http://cdn.zhouchuang.site/img/20240717224310.png)

* ä»¥å­—æ¯ m ç»“å°¾

  ![image-20240717224401323](http://cdn.zhouchuang.site/img/20240717224402.png)

* cat -A æ˜¾å¼å‡ºéšè—çš„å­—ç¬¦

  ![image-20240717224755968](http://cdn.zhouchuang.site/img/20240717224757.png)

#### ^$ ç©ºè¡Œï¼Œè¿™è¡Œä¸­æ²¡æœ‰ä»»ä½•å­—ç¬¦

![image-20240717224938456](http://cdn.zhouchuang.site/img/20240717224939.png)

æ’é™¤ç©ºè¡Œ

![image-20240717225017418](http://cdn.zhouchuang.site/img/20240717225018.png)

> ç”¨äºæ’é™¤æ–‡ä»¶ä¸­çš„ç©ºè¡Œï¼Œæ’é™¤ç©ºè¡Œå’Œå¸¦äº•å·çš„è¡Œ

#### . ä»»æ„ä¸€ä¸ªå­—ç¬¦

* oldbä»»æ„ä¸€ä¸ªå­—ç¬¦y

  ![image-20240717225350065](http://cdn.zhouchuang.site/img/20240717225350.png)

  > äº†è§£ï¼š. è¿‡æ»¤çš„æ—¶å€™ä¼šæ’é™¤ç©ºè¡Œï¼Œ. ä¸ä¼šåŒ¹é…ç©ºè¡Œ

#### \ è½¬ä¹‰å­—ç¬¦

æ‰¾å‡ºä»¥ . ç»“å°¾çš„

![image-20240718090235105](http://cdn.zhouchuang.site/img/20240718090236.png)

#### `*`  åŒ¹é…å¤šæ¬¡

å‰ä¸€ä¸ªå­—ç¬¦è¿ç»­å‡ºç° 0 æ¬¡æˆ– 0 æ¬¡ä»¥ä¸Š

![image-20240718104453599](http://cdn.zhouchuang.site/img/20240718104454.png)

#### `.*` æ‰€æœ‰

ç‚¹è¡¨ç¤ºä»»æ„å­—ç¬¦ï¼Œæ˜Ÿå·è¡¨ç¤ºå¤šä¸ªï¼Œæ‰€ä»¥`.*`è¡¨ç¤ºæ‰€æœ‰å­—ç¬¦

![image-20240718104651438](http://cdn.zhouchuang.site/img/20240718104652.png)

è´ªå©ªï¼šæ­£åˆ™è¡¨ç¤ºè¿ç»­å‡ºç°çš„æ—¶å€™ï¼Œè¡¨ç¤ºæ‰€æœ‰çš„æ—¶å€™ï¼Œä½“ç°å‡ºè´ªå©ªæ€§

* åŒ¹é…å¼€å¤´ä¸€ç›´åˆ° o çš„å†…å®¹

  ![image-20240718105154102](http://cdn.zhouchuang.site/img/20240718105154.png)

#### `[]`  åŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦

[abc] è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸€ä¸ªå­—ç¬¦ï¼Œa æˆ– b æˆ– cï¼Œä¸­æ‹¬å·ç›¸å½“äºä¸€ä¸ªå­—ç¬¦

![image-20240718105413725](http://cdn.zhouchuang.site/img/20240718105414.png)

* åŒ¹é…æ•°å­—

  ```bash
  grep '[0-9]' re.txt
  ```

* åŒ¹é…å°å†™å­—æ¯

  ```bash
  grep '[a-z]' re.txt
  ```

* åŒ¹é…å¤§å†™å­—æ¯

  ```bash
  grep '[A-Z]' re.txt
  ```

* åŒ¹é…å¤§å°å†™å­—æ¯

  ```bash
  grep '[a-zA-Z]' re.txt
  ```

* åŒ¹é…å¤§å°å†™å­—æ¯+æ•°å­—

  ```bash
  grep '[a-zA-Z0-9]' re.txt 
  grep '[0-Z]' re.txt
  ```

* åŒ¹é…å‡ºä»¥å­—æ¯ m æˆ– n å¼€å¤´çš„è¡Œ

  ![image-20240718113603563](http://cdn.zhouchuang.site/img/20240718113604.png)

* åŒ¹é…å‡ºä»¥ . æˆ–ç©ºæ ¼æˆ–ï¼ç»“å°¾çš„è¡Œ

  ![image-20240718113709442](http://cdn.zhouchuang.site/img/20240718113710.png)

> [ ] ä¼šè‡ªåŠ¨å»æ‰ç¬¦å·çš„ç‰¹æ®Šå«ä¹‰

#### [^] å–å

[^abc] è¡¨ç¤ºåŒ¹é…ä»»æ„ 1 ä¸ªå­—ç¬¦ï¼Œæ’é™¤ abcï¼Œä¸­æ‹¬å·ç›¸å½“äºä¸€ä¸ªå­—ç¬¦

![image-20240718114011872](http://cdn.zhouchuang.site/img/20240718114012.png)

#### å°ç»“

| åŸºç¡€æ­£åˆ™ | å«ä¹‰                           |
| -------- | ------------------------------ |
| ^        | ä»¥xxx å¼€å¤´çš„è¡Œ                 |
| $        | ä»¥...ç»“å°¾çš„è¡Œ                  |
| ^$       | ç©ºè¡Œ                           |
| .        | ä»»æ„ä¸€ä¸ªå­—ç¬¦                   |
| \        | è½¬ä¹‰å­—ç¬¦                       |
| *        | å‰ä¸€ä¸ªå­—ç¬¦å‡ºç°0 æ¬¡æˆ–å¤šæ¬¡       |
| .*       | æ‰€æœ‰                           |
| [ ]      | åŒ¹é…æ‹¬å·ä¸­çš„ä¸€ä¸ªå­—ç¬¦           |
| [^]      | [^abc] åŒ¹é…é™¤äº† abc ä¹‹å¤–çš„å†…å®¹ |

### 1.3 æ‰©å±•æ­£åˆ™

* egrep æˆ– grep -E
* sedä½¿ç”¨ sed -r æ”¯æŒæ‰©å±•æ­£åˆ™
* awk é»˜è®¤æ”¯æŒæ‰©å±•æ­£åˆ™

#### + å‰ä¸€ä¸ªå­—ç¬¦è¿ç»­å‡ºç° 1 æ¬¡æˆ–ä»¥ä¸Š

> `+` å¤§éƒ¨åˆ†é…åˆ`[ ]` ä½¿ç”¨

* å–å‡ºè¿ç»­å‡ºç°çš„ 0

  ![image-20240718141059754](http://cdn.zhouchuang.site/img/20240718141102.png)

* å–å‡ºè¿ç»­å‡ºç°çš„æ•°å­—

  ![image-20240718141236332](http://cdn.zhouchuang.site/img/20240718141237.png)

* å–å‡ºè¿ç»­å‡ºç°çš„å­—æ¯

  ![image-20240718141314633](http://cdn.zhouchuang.site/img/20240718141315.png)

  ![image-20240718141441396](http://cdn.zhouchuang.site/img/20240718141442.png)

#### | æˆ–è€…

* æ–‡ä»¶ä¸­åŒ…å« oldboy æˆ–linux çš„

  ![image-20240718141545807](http://cdn.zhouchuang.site/img/20240718141547.png)

* æ’é™¤/ect/ssh/sshd_config ä¸­çš„ç©ºå·æˆ–è€…æ³¨é‡Šè¡Œï¼Œè¾“å‡ºæ˜¾å¼è¡Œå·

  ![image-20240718142114106](http://cdn.zhouchuang.site/img/20240718142115.png)

#### () è¡¨ç¤ºä¸€ä¸ªæ•´ä½“ï¼Œç”¨äºåå‘å¼•ç”¨ï¼ˆåå‘å¼•ç”¨ sedï¼‰

![image-20240718142447147](http://cdn.zhouchuang.site/img/20240718142448.png)

![image-20240718142708279](http://cdn.zhouchuang.site/img/20240718142710.png)

#### {}  å¤§æ‹¬å·

a{n,m} å‰ä¸€ä¸ªå­—ç¬¦è¿ç»­å‡ºç°è‡³å°‘ n æ¬¡ï¼Œæœ€å¤š m æ¬¡

| æ ¼å¼                                          | è§£é‡Š               |
| --------------------------------------------- | ------------------ |
| a{n,m} å‰ä¸€ä¸ªå­—ç¬¦è¿ç»­å‡ºç°è‡³å°‘ n æ¬¡ï¼Œæœ€å¤š m æ¬¡ | è¡¨ç¤ºè¿ç»­å‡ºç°çš„èŒƒå›´ |
| a{n} å‰ä¸€ä¸ªå­—ç¬¦è¿ç»­å‡ºç°n æ¬¡                   | åŒ¹é…å›ºå®šçš„æ¬¡æ•°     |
| a{n,} å‰ä¸€ä¸ªå­—ç¬¦è‡³å°‘è¿ç»­å‡ºç° n æ¬¡             |                    |
| a{,m} å‰ä¸€ä¸ªå­—ç¬¦è¿ç»­å‡ºç°ï¼Œæœ€å¤š m æ¬¡           |                    |



![image-20240718143917915](http://cdn.zhouchuang.site/img/20240718143919.png)

åŒ¹é…èº«ä»½è¯çš„æ­£åˆ™ï¼š

åˆ†æï¼šå‰ 17 ä¸ºä¸ºæ•°å­—ï¼Œåä¸€ä½ä¸ºæ•°å­—æˆ–ä¸º X

![image-20240718144228285](http://cdn.zhouchuang.site/img/20240718144229.png)

#### ? å‰ä¸€ä¸ªå­—ç¬¦å‡ºç° 0 æ¬¡æˆ– 1 æ¬¡

![image-20240718144715051](http://cdn.zhouchuang.site/img/20240718144716.png)

#### å°ç»“

| æ‰©å±•æ­£åˆ™ | å«ä¹‰                                          |
| -------- | --------------------------------------------- |
| +        | å‰ä¸€ä¸ªå­—ç¬¦è¿ç»­å‡ºç° 1 æ¬¡æˆ–å¤šæ¬¡                 |
| \|       | æˆ–è€…                                          |
| ( )      | :a: è¡¨ç¤ºæ•´ä½“ï¼Œ:b: åå‘å¼•ç”¨æˆ–åå‘å¼•ç”¨(sed)     |
| { }      | a{n,m} å‰ä¸€ä¸ªå­—ç¬¦è¿ç»­å‡ºç°è‡³å°‘ n æ¬¡ï¼Œæœ€å¤š m æ¬¡ |
| ?        | å‰ä¸€ä¸ªå­—ç¬¦å‡ºç° 0 æ¬¡æˆ– 1 æ¬¡                    |

### 1.4 perl è¯­è¨€æ­£åˆ™

| ç¬¦å· | å«ä¹‰                    |
| ---- | :---------------------- |
| \d   | [0-9]                   |
| \s   | åŒ¹é…ç©ºå­—ç¬¦ ç©ºæ ¼ã€tab ç­‰ |
| \w   | [0-9a-zA-Z_]            |
| \D   | [^0-9] æ’é™¤æ•°å­—         |
| \S   | éç©ºå­—ç¬¦                |
| \W   | æ’é™¤æ•°å­—ã€å­—æ¯å’Œ_       |

![image-20240718145439957](http://cdn.zhouchuang.site/img/20240718145441.png)

### 1.5 é›¶ç¢çš„æ­£åˆ™

![image-20240718150112675](http://cdn.zhouchuang.site/img/20240718150113.png)

## 2. sed

### 2.1 æ¦‚è¿°

* å–è¡Œï¼Œè¿‡æ»¤ï¼Œæ›¿æ¢ä¿®æ”¹æ–‡ä»¶å†…å®¹
* åå‘å¼•ç”¨

### 2.2 æ ¼å¼

|      |      |            |      |
| ---- | ---- | ---------- | ---- |
| sed  | é€‰é¡¹ | 'æ¡ä»¶åŠ¨ä½œ' | æ–‡ä»¶ |
|      |      | 'æ‰¾è°å¹²å•¥' |      |



| é€‰é¡¹   | è¯´æ˜                           |
| ------ | ------------------------------ |
| -n     | å–æ¶ˆé»˜è®¤è¾“å‡º                   |
| -r     | sedæ”¯æŒæ‰©å±•æ­£åˆ™                |
| -i     | ä¿®æ”¹æ–‡ä»¶å†…å®¹ï¼Œè¿™ä¸ªé€‰é¡¹æ”¾åœ¨æœ€å |
| -i.bak | å…ˆå¤‡ä»½åœ¨ä¿®æ”¹ï¼Œè¿™ä¸ªé€‰é¡¹æ”¾æœ€å   |
|        |                                |



### 2.3 å¦‚ä½•è¿è¡Œ

- æ¨¡å¼ç©ºé—´ï¼šå®¹çº³å½“å‰è¡Œçš„ç¼“å†²åŒºï¼Œå³é€šè¿‡`æ¨¡å¼åŒ¹é…åˆ°çš„è¡Œ`è¢«è¯»å…¥è¯¥ç©ºé—´ä¸­
- ä¿æŒç©ºé—´ï¼šä¸€ä¸ªè¾…åŠ©ç¼“å†²åŒºï¼Œå¯ä»¥å’Œæ¨¡å¼ç©ºé—´è¿›è¡Œäº¤äº’ï¼ˆé€šè¿‡h,H,g,Gï¼‰ï¼Œä½†å‘½ä»¤`ä¸èƒ½ç›´æ¥ä½œç”¨äºè¯¥ç©ºé—´`ï¼Œåœ¨è¿›è¡Œæ•°æ®å¤„ç†æ—¶ä½œä¸ºâ€œæš‚å­˜åŒºåŸŸâ€

![åŸç†æ¦‚å¿µ](http://cdn.zhouchuang.site/img/20240718154254.png)

æ‰§è¡Œæ­¥éª¤ï¼š

1ï¼‰è¯»å…¥ä¸€è¡Œæ•°æ®åˆ°æ¨¡å¼ç©ºé—´

2ï¼‰åœ¨æ¨¡å¼ç©ºé—´æ‰§è¡Œsedå‘½ä»¤

3ï¼‰å°†æ›´æ–°/ä¿®æ”¹åçš„å†…å®¹è¾“å‡º

4ï¼‰æ¸…ç©ºæ¨¡å¼ç©ºé—´ï¼Œå¹¶é‡å¤ç¬¬ä¸€æ­¥ï¼Œç›´åˆ°æ–‡ä»¶ç»“æŸ

![æ‰§è¡Œæµç¨‹](http://cdn.zhouchuang.site/img/20240718154358.png)

### 2.4 sed å¢åˆ æ”¹æŸ¥ä¹‹æŸ¥æ‰¾

* ç±»ä¼¼grep å‘½ä»¤çš„è¿‡æ»¤ï¼Œæ¯” grep å¼ºåœ¨å¯ä»¥æŒ‡å®šè¡Œå·
* ç±»ä¼¼äº grep å‘½ä»¤çš„åŠŸèƒ½ï¼Œæ¨¡ç³ŠæŸ¥è¯¢ï¼ˆé€šè¿‡æ­£åˆ™ï¼‰

![image-20240718192412277](http://cdn.zhouchuang.site/img/20240718192413.png)

æ¡ˆä¾‹ 1ï¼š å–å‡ºæ–‡ä»¶ç¬¬ä¸‰è¡Œ

![image-20240718155037784](http://cdn.zhouchuang.site/img/20240718155038.png)

æ¡ˆä¾‹ 2ï¼šå–å‡º/etc/passwdçš„ç¬¬2è¡Œåˆ°ç¬¬5è¡Œ

![image-20240718155205169](http://cdn.zhouchuang.site/img/20240718155205.png)

æ¡ˆä¾‹ 3ï¼šè¿‡æ»¤å‡º/etc/passwdä¸­åŒ…å«root çš„è¡Œ

![image-20240718155509804](http://cdn.zhouchuang.site/img/20240718155510.png)

> sed è¿›è¡Œè¿‡æ»¤çš„æ—¶å€™éœ€è¦ä½¿ç”¨// å¹¶ä¸”é‡Œé¢æ”¯æŒåŸºç¡€æ­£åˆ™
>
> å¦‚æœéœ€è¦ä½¿ç”¨æ‰©å±•æ­£åˆ™åˆ™éœ€è¦ä½¿ç”¨ sed -r é€‰é¡¹

æ¡ˆä¾‹ï¼šè·å–èŒƒå›´å†…çš„æ—¥å¿—

```bash
cat >sed.txt<<EOF
101,oldboy,CEO
102,bigbao,CTO
103,æå¯¼996,COO
104,yy,CFO
105,feixue,CIO
110,lidao,COCO
EOF
```

![image-20240718160021447](http://cdn.zhouchuang.site/img/20240718160022.png)

æ¡ˆä¾‹ï¼šå–å‡º access.log è¿‡æ»¤å‡º 11:05 åˆ° 11:06åˆ†çš„æ—¥å¿—

```bash
sed -n '/11:05:00/, /11:06:00/p' access.log
```

æ¡ˆä¾‹ï¼šåªæ˜¾ç¤ºç¬¬ 2 è¡Œå’Œç¬¬ 5 è¡Œ

![image-20240718162902533](http://cdn.zhouchuang.site/img/20240718162903.png)

æ¡ˆä¾‹ï¼šè¡¨ç¤ºæœ‰è§„å¾‹çš„æŸ¥æ‰¾

![image-20240718163146125](http://cdn.zhouchuang.site/img/20240718163146.png)

### 2.5 sed å¢åˆ æ”¹æŸ¥ä¹‹ä¿®æ”¹

* sed çš„ä¿®æ”¹å«åšæ›¿æ¢
* sed é»˜è®¤ä¸ä¿®æ”¹ï¼ŒåŠ ä¸Š -i é€‰é¡¹èƒ½ä¿®æ”¹

1. æ¡ˆä¾‹ï¼šæŠŠ sed.txt æ–‡ä»¶ä¸­ lidao æ›¿æ¢ä¸º oldboy

   ```bash
   sed 's#lidao#oldboy#g' sed.txt
   ```

   ```bash
   sed 's###g' sed.txt
   sed 's#æ‰¾è°#æ›¿æ¢æˆä»€ä¹ˆ#g' sed.txt
   s substitute æ›¿æ¢
   g global å…¨å±€æ›¿æ¢ è¿™ä¸€è¡Œä¸­æŠŠæ‰€æœ‰åŒ¹é…åˆ°çš„å†…å®¹å…¨éƒ½è¿›è¡Œæ›¿æ¢ï¼Œå¦åˆ™åªæ›¿æ¢æ¯ä¸€è¡Œç¬¬ä¸€ä¸ªåŒ¹é…çš„å†…å®¹
   ```

   ```bash
   âœ  ~ sed 's#[0-9]##g' sed.txt    # å°†æ•°å­—æ›¿æ¢ä¸ºç©º
   ,oldboy,CEO
   ,bigbao,CTO
   ,æå¯¼,COO
   ,yy,CFO
   ,feixue,CIO
   ,lidao,COCO
   âœ  ~ sed 's#[0-9]##' sed.txt
   01,oldboy,CEO
   02,bigbao,CTO
   03,æå¯¼996,COO
   04,yy,CFO
   05,feixue,CIO
   10,lidao,COCO
   ```

   ![image-20240718164343092](http://cdn.zhouchuang.site/img/20240718164343.png)

   > sed å‘½ä»¤æ›¿æ¢çš„æ—¶å€™ s###g
   >
   > ä¹Ÿå¯ä»¥å†™ä¸º s@@@g  s///g

* ä¿®æ”¹æ–‡ä»¶å†…å®¹ä¹‹å‰è¿›è¡Œå¤‡ä»½ï¼Œç„¶åä¿®æ”¹æ–‡ä»¶å†…å®¹

  ```bash
  sed -i.bak 's#bigbao#oldbao#g' sed.txt
  ```



### 2.6 å¢åˆ æ”¹æŸ¥ä¹‹æ›¿æ¢

123456 åŠ ä¸Š<> å˜æˆ<123456>

```bash
âœ  ~ echo 123456 | sed -r 's#(.*)#<\1>#g'
<123456>
```

\1 è¡¨ç¤ºå‰é¢(.*)ä¸­åŒ¹é…åˆ°çš„å†…å®¹ ()å°æ‹¬å·è¡¨ç¤ºåˆ†ç»„ \1 è¡¨ç¤ºå–å‡ºç¬¬ä¸€ç»„çš„å†…å®¹ï¼Œ -r è¡¨ç¤ºç”¨åˆ°æ‰©å±•æ­£åˆ™



* ç»™æ¯ä¸ªæ•°å­—éƒ½åŠ ä¸Š<>

  ```bash
  âœ  ~ echo 123456 | sed -r 's#([0-9])#<\1>#g'
  <1><2><3><4><5><6>
  âœ  ~ echo 123456 | sed -r 's#(.)#<\1>#g'
  <1><2><3><4><5><6>
  ```



#### åå‘å¼•ç”¨æ ¼å¼

> åº”ç”¨è¯´æ˜ï¼š
>
> sed å‘½ä»¤ç”¨äºå¤„ç†åˆ—çš„æ–¹å¼ã€‚

ä½¿ç”¨æ ¼å¼ï¼š

> ä½¿ç”¨æ›¿æ¢çš„å½¢å¼ s###g
>
> å‰ä¸¤ä¸ªäº•å·ä¹‹é—´é€šè¿‡æ­£åˆ™åŠ å°æ‹¬å·ï¼Œè¿›è¡Œåˆ†ç»„ï¼Œ
>
> åä¸¤ä¸ªäº•å·ä¹‹é—´é€šè¿‡ \æ•°å­— è·å–å‰é¢åˆ†ç»„çš„å†…å®¹ï¼Œ
>
> æ•´ä½“æ˜¯åé¢è°ƒç”¨å‰é¢åˆ†ç»„çš„å†…å®¹ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºåå‘å¼•ç”¨ï¼ˆåå‘å¼•ç”¨ï¼‰

#### æ¡ˆä¾‹

1. è°ƒæ¢ /etc/passwd ç¬¬ä¸€åˆ—å’Œæœ€åä¸€åˆ—çš„å†…å®¹

   ```bash
   root:x:0:0:root:/root:/bin/zsh
   bin:x:1:1:bin:/bin:/sbin/nologin
   daemon:x:2:2:daemon:/sbin:/sbin/nologin
   adm:x:3:4:adm:/var/adm:/sbin/nologin
   lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
   ```

   ```bash
   sed -r 's#(^.*)(:x.*:)(.*$)#\3\2\1#g' passwd
   ```



2. å–å‡ºç½‘å¡ ip åœ°å€

   ```bash
   âœ  ~ ip a s eth0
   2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
       link/ether 00:16:3e:2f:45:fa brd ff:ff:ff:ff:ff:ff
       inet 172.18.243.120/20 brd 172.18.255.255 scope global dynamic eth0
          valid_lft 313947416sec preferred_lft 313947416sec
       inet6 fe80::216:3eff:fe2f:45fa/64 scope link
          valid_lft forever preferred_lft forever
   âœ  ~ ip a s eth0 |sed -n '3p'
       inet 172.18.243.120/20 brd 172.18.255.255 scope global dynamic eth0
   âœ  ~ ip a s eth0 |sed -n '3p' | sed -r 's#^.*inet (.*) brd.*$#\1#g'
   172.18.243.120/20
   ```

   è¿›é˜¶ï¼š

   ```bash
    sed -n '3p'
    sed -r 's#^.*inet (.*) brd.*$#\1#g'
    
    ---
    sed -nr '3 s#^.*inet (.*) brd.*$#\1#g p'
   ```



3. å–å‡º stat /etc/hosts ä¸­çš„ 0644 æˆ– 644

   ```bash
   âœ  ~ stat /etc/hosts
     æ–‡ä»¶ï¼š"/etc/hosts"
     å¤§å°ï¼š213       	å—ï¼š8          IO å—ï¼š4096   æ™®é€šæ–‡ä»¶
   è®¾å¤‡ï¼šfd01h/64769d	Inodeï¼š262194      ç¡¬é“¾æ¥ï¼š1
   æƒé™ï¼š(0644/-rw-r--r--)  Uidï¼š(    0/    root)   Gidï¼š(    0/    root)
   æœ€è¿‘è®¿é—®ï¼š2024-07-20 10:28:17.784713652 +0800
   æœ€è¿‘æ›´æ”¹ï¼š2024-07-04 10:26:00.231943650 +0800
   æœ€è¿‘æ”¹åŠ¨ï¼š2024-07-04 10:26:00.231943650 +0800
   åˆ›å»ºæ—¶é—´ï¼š-
   
   âœ  ~ stat /etc/hosts | sed -nr '4 s#^.*\((.*)/-rw.*$#\1#g p'
   0644
   ```

### 2.7 å¢åˆ æ”¹æŸ¥ä¹‹åˆ é™¤

- d sed å‘½ä»¤åˆ é™¤åŠŸèƒ½æŒ‰ç…§ è¡Œ ä¸ºå•ä½è¿›è¡Œ
- å¦‚æœä»…ä»…åˆ é™¤æŸä¸€è¡Œçš„ä¸€äº›å­—ç¬¦æ¨èä½¿ç”¨ 's###g'

```bash
âœ  ~ cat sed.txt
101,oldboy,CEO
102,oldbao,CTO
103,æå¯¼996,COO
104,yy,CFO
105,feixue,CIO
110,oldboy,COCO
âœ  ~ sed '3d' sed.txt  # åˆ é™¤ç¬¬ä¸‰è¡Œ
101,oldboy,CEO
102,oldbao,CTO
104,yy,CFO
105,feixue,CIO
110,oldboy,COCO
```

æ’é™¤/åˆ é™¤ æ–‡ä»¶ä¸­çš„ç©ºè¡Œå’Œå¸¦æ³¨é‡Šçš„è¡Œ

```bash
sed -r '/^$|#/d' /etc/ssh/sshd_config
```

### 2.8 å¢åˆ æ”¹æŸ¥ä¹‹å¢åŠ 

- cai

    * a  append åœ¨æŒ‡å®šè¡Œåè¿½åŠ 

      ```bash
      âœ  ~ cat sed.txt
      101,oldboy,CEO
      102,oldbao,CTO
      103,æå¯¼996,COO
      104,yy,CFO
      105,feixue,CIO
      110,oldboy,COCO
      âœ  ~ sed '3a 1024,aszhc,ufc' sed.txt
      101,oldboy,CEO
      102,oldbao,CTO
      103,æå¯¼996,COO
      1024,aszhc,ufc
      104,yy,CFO
      105,feixue,CIO
      110,oldboy,COCO
      ```

    * i insert åœ¨æŒ‡å®šè¡Œä¸Šæ’å…¥

    * c replace æ›¿æ¢æŒ‡å®šè¡Œçš„å†…å®¹

## 3. awk

> å•è¡Œè„šæœ¬

* å–è¡Œ
* å–åˆ—
* æ··åˆå–è¡Œåˆ—
* åˆ¤æ–­ä¸è¿ç®—
* æ•°ç»„

| å››å‰‘å®¢     | ç‰¹ç‚¹                                      | æ“…é•¿                 |
| ---------- | ----------------------------------------- | -------------------- |
| find       | æŸ¥æ‰¾æ–‡ä»¶                                  | æŸ¥æ‰¾æ–‡ä»¶             |
| grep/egrep | è¿‡æ»¤                                      | è¿‡æ»¤é€Ÿåº¦æœ€å¿«         |
| sed        | è¿‡æ»¤ã€å–è¡Œã€æ›¿æ¢ã€åˆ é™¤                    | æ›¿æ¢ï¼Œä¿®æ”¹ï¼Œå–è¡Œ     |
| awk        | è¿‡æ»¤ã€å–è¡Œã€å–åˆ—ã€ç»Ÿè®¡è®¡ç®—ã€åˆ¤æ–­ã€å¾ªç¯... | å–è¡Œã€å–åˆ—ã€ç»Ÿè®¡è®¡ç®— |

* awkæ˜¯ä¸€ä¸ªè¯­è¨€ï¼Œå«åšå•è¡Œè„šæœ¬

### 2.1 æ¦‚è¿°

#### 1. æ ¼å¼

```bash
å–å‡º/etc/passwdä¸­ç¬¬ä¸€è¡Œçš„ç¬¬ä¸€åˆ—ã€ç¬¬ä¸‰åˆ—å’Œæœ€åä¸€åˆ—
awk -F 'NR==1{print $1,$3,$NF}' /etc/passwd

awk é€‰é¡¹ 'æ¡ä»¶{åŠ¨ä½œ}'  /etc/passwd
		æ¡ä»¶ï¼šæ‰¾è°
		åŠ¨ä½œï¼šåšä»€ä¹ˆ
```

#### 2. æ‰§è¡Œæµç¨‹

### 2.2 å–è¡Œ



* å–å‡º/ect/passwd çš„ç¬¬ä¸€è¡Œ

  ```bash
  awk 'NR==1{print $0}' /etc/passwd
  ```

> NRï¼šNumber of Record è®°å½•ï¼Œè¡Œå·
>
> == è¡¨ç¤ºç­‰äº
>
> `{print $0}` è¾“å‡ºæ­£å¥½å†…å®¹ï¼Œ $0 è¡¨ç¤ºå½“å‰è¡Œçš„å†…å®¹
>
> ä»…å–è¡Œï¼Œå¯ä»¥ç®€å†™ä¸ºï¼š
>
> ```bash
> awk 'NR==1' /etc/passwd
> ```

* å–å‡ºç¬¬ 2 è¡Œåˆ°ç¬¬ 5 è¡Œçš„å†…å®¹

  ```bash
  âœ  ~ awk 'NR>=2 && NR<=5' passwd
  bin:x:1:1:bin:/bin:/sbin/nologin
  daemon:x:2:2:daemon:/sbin:/sbin/nologin
  adm:x:3:4:adm:/var/adm:/sbin/nologin
  lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
  ```

  > `>=` è¡¨ç¤ºå¤§äºç­‰äº
  >
  > && è¡¨ç¤ºå¹¶
  >
  > || è¡¨ç¤ºæˆ–

| awkå¸¸ç”¨çš„è¿ç®—ç¬¦ | è¯´æ˜ |
| --------------- | ---- |
| ==ã€ !=         | ç­‰äº |
| >ã€<ã€>=ã€<=    |      |
| &&              |      |
| \|\|            |      |

* è¿‡æ»¤å‡º/ect/passwdæ–‡ä»¶ä¸­åŒ…å« root æˆ– nobodyçš„è¡Œ

  ```bash
  âœ  ~ awk '/root|nobody/' /etc/passwd
  root:x:0:0:root:/root:/bin/zsh
  operator:x:11:0:operator:/root:/sbin/nologin
  nobody:x:99:99:Nobody:/:/sbin/nologin
  nfsnobody:x:65534:65534:Anonymous NFS User:/var/lib/nfs:/sbin/nologin
  ```

* ä»åŒ…å« root çš„è¡Œ**åˆ°**åŒ…å« nobody çš„è¡Œ

  ```bash
  âœ  ~ awk '/root/,/nobody/' /etc/passwd
  root:x:0:0:root:/root:/bin/zsh
  bin:x:1:1:bin:/bin:/sbin/nologin
  daemon:x:2:2:daemon:/sbin:/sbin/nologin
  adm:x:3:4:adm:/var/adm:/sbin/nologin
  lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
  sync:x:5:0:sync:/sbin:/bin/sync
  shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
  halt:x:7:0:halt:/sbin:/sbin/halt
  mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
  operator:x:11:0:operator:/root:/sbin/nologin
  games:x:12:100:games:/usr/games:/sbin/nologin
  ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin
  nobody:x:99:99:Nobody:/:/sbin/nologin
  ```

* å°ç»“

    * awk + NR å–å‡ºæŒ‡å®šçš„è¡Œï¼ŒæŒ‡å®šèŒƒå›´çš„è¡Œ
    * awk + // è¿‡æ»¤
    * awk + å…¶ä»–å˜é‡åŠŸèƒ½ç”¨äºç²¾ç¡®è¿‡æ»¤

### 2.3 å–åˆ—

* ä½¿ç”¨ awk å–å‡º ls -lh çš„å¤§å°åˆ—å’Œæœ€åä¸€åˆ—

  ```bash
  âœ  ~ ls -lh /etc/hosts |awk '{print $5,$9}'
  213 /etc/hosts
  âœ  ~ ls -lh /etc/hosts |awk '{print $5,$NF}'
  213 /etc/hosts
  ```

> awkä¸­ï¼Œ $æ•°å­— è¡¨ç¤ºåˆ—ï¼Œ`$1` è¡¨ç¤ºç¬¬ä¸€åˆ—ï¼Œ`$0`è¡¨ç¤ºå½“å‰è¿™è¡Œ
>
> `$NF`æœ€åä¸€åˆ—
>
> NF Number of Field æ¯è¡Œæœ‰å¤šå°‘åˆ—
>
> $(NF-1) å€’æ•°ç¬¬äºŒåˆ—ï¼Œç”¨äºè¡Œæ•°å¤ªå¤šï¼Œæˆ–è€…æ­£åºæ•°æ— è§„å¾‹çš„æƒ…å†µ
>
> ```bash
> ls -lh /etc/hosts |awk '{print $(NF-1)}' # å€’æ•°ç¬¬äºŒåˆ—
> ```

* å–å‡º/etc/passwdä¸­ç¬¬ä¸€åˆ—ï¼Œç¬¬ 3 åˆ—å’Œæœ€åä¸€åˆ—

  > awk å–åˆ—çš„æ—¶å€™ï¼Œé»˜è®¤æ˜¯é€šè¿‡ç©ºç™½å­—ç¬¦è¿›è¡Œåˆ†å‰²çš„
  >
  > ç©ºç™½å­—ç¬¦ï¼šç©ºæ ¼ï¼Œè¿ç»­ç©ºæ ¼ï¼Œtab é”®
  >
  > ä½†æ˜¯ä¸€äº›æ—¶å€™é»˜è®¤åˆ†éš”ç¬¦ä¸å¤Ÿäº†ï¼Œéœ€è¦ä½¿ç”¨æ‰‹åŠ¨æŒ‡å®šåˆ†éš”ç¬¦ï¼Œé€šè¿‡-F æŒ‡å®š
  >
  > é€‰æ‹©åˆ†éš”ç¬¦å»ºè®®ï¼šçœ‹ä½ ç›®æ ‡ä¸¤è¾¹æ˜¯å•¥

  ```bash
  âœ  ~ awk -F':' '{print $1,$3,$NF}' passwd
  root 0 /bin/zsh
  bin 1 /sbin/nologin
  daemon 2 /sbin/nologin
  adm 3 /sbin/nologin
  
  âœ  ~ awk -F':' '{print $1,$3,$NF}' passwd|column -t
  root             0      /bin/zsh
  bin              1      /sbin/nologin
  daemon           2      /sbin/nologin
  adm              3      /sbin/nologin
  lp               4      /sbin/nologin
  ```

  `column -t` å¯¹é½

* æŒ‡å®šå¤æ‚åˆ†éš”ç¬¦å–å‡º ip

  ```bash
  âœ  ~ ip a s eth0 | awk 'NR==3{print $2}'
  172.18.243.120/20
  âœ  ~ ip a s eth0 | awk 'NR==3{print $2}' | awk -F'/' '{print $1}'
  172.18.243.120
  âœ  ~ ip a s eth0 | awk 'NR==3' | awk -F'[ /]' '{print $6}'
  172.18.243.120
  âœ  ~ ip a s eth0 | awk 'NR==3' | awk -F'[ /]+' '{print $3}'
  172.18.243.120
  ```

  ![image-20240721151206875](http://cdn.zhouchuang.site/img/20240721151208.png)

**å°ç»“**

* å¦‚æœæ˜¯ç©ºæ ¼ï¼Œè¿ç»­ç©ºæ ¼ï¼Œç›´æ¥ä½¿ç”¨ awk å–åˆ—å³å¯
* å…¶ä»–æƒ…å†µéœ€è¦é€šè¿‡ -F æŒ‡å®šåˆ†éš”ç¬¦åŠ æ­£åˆ™å®ç° []ã€ []+ã€ |

### 2.4 å–è¡ŒåŒæ—¶å–åˆ—

* å– ip åœ°å€

  ```bash
  âœ  ~ ip a s eth0 | awk -F'[ /]+' 'NR==3''{print $3}'
  172.18.243.120
  ```

* å–å‡ºæƒé™éƒ¨åˆ† stat /etc/hostsçš„ 0644éƒ¨åˆ†

  ```bash
  âœ  ~ stat /etc/hosts
    æ–‡ä»¶ï¼š"/etc/hosts"
    å¤§å°ï¼š213       	å—ï¼š8          IO å—ï¼š4096   æ™®é€šæ–‡ä»¶
  è®¾å¤‡ï¼šfd01h/64769d	Inodeï¼š262194      ç¡¬é“¾æ¥ï¼š1
  æƒé™ï¼š(0644/-rw-r--r--)  Uidï¼š(    0/    root)   Gidï¼š(    0/    root)
  æœ€è¿‘è®¿é—®ï¼š2024-07-21 10:28:17.784671787 +0800
  æœ€è¿‘æ›´æ”¹ï¼š2024-07-04 10:26:00.231943650 +0800
  æœ€è¿‘æ”¹åŠ¨ï¼š2024-07-04 10:26:00.231943650 +0800
  åˆ›å»ºæ—¶é—´ï¼š-
  
  âœ  ~ stat /etc/hosts | awk -F'[/(]' 'NR==4''{print $2}'
  0644
  âœ  ~ stat /etc/hosts | awk -F'[^0-9]+' 'NR==4''{print $2}'
  0644
  ```



* å¯¹åˆ—çš„åˆ¤æ–­ï¼Œå–å‡º/etc/passwd æ–‡ä»¶ä¸­ç¬¬3åˆ—å¤§äº 1000çš„è¡Œï¼Œå–å‡ºè¿™ä¸€åˆ—ï¼Œç¬¬ 3 åˆ—å’Œæœ€åä¸€åˆ—

    * æ¡ä»¶ï¼š$3
    * åŠ¨ä½œï¼šç¬¬ 3 åˆ—å’Œæœ€åä¸€åˆ—

  ```bash
  âœ  ~ awk -F':' '$3>1000''{print $1,$3,$NF}' /etc/passwd
  nfsnobody 65534 /sbin/nologin
  âœ  ~ awk -F':' '$3>1000''{print $1,$3,$NF}' /etc/passwd|column -t
  nfsnobody  65534  /sbin/nologin
  ```

  > é€šè¿‡ awk å®ç°å¯¹æŸä¸€åˆ—è¿›è¡Œåˆ¤æ–­

* å¦‚æœç³»ç»Ÿ swap ä½¿ç”¨è¶…è¿‡ 0 åˆ™è¾“å‡º"å¼‚å¸¸ç³»ç»Ÿå¼€å§‹å ç”¨ swap"

  ```bash
  âœ  ~ free |awk '/Swap/ && $3>=0 {print "ç³»ç»Ÿå¼‚å¸¸"}'
  ç³»ç»Ÿå¼‚å¸¸
  ```

* è¿‡æ»¤å‡º/etc/passwdç¬¬ 4 åˆ—çš„æ•°å­—æ˜¯ä»¥ 0 æˆ– 1 å¼€å¤´çš„è¡Œï¼Œè¾“å‡ºç¬¬ 1ã€3åˆ—

    * ä¹‹å‰^æˆ–$ è¡¨ç¤ºæŸä¸€è¡Œçš„å¼€å¤´æˆ–ç»“å°¾
    * åœ¨ awk ä¸­å› ä¸º awk å¯ä»¥å–åˆ—ï¼Œé€šè¿‡åˆ—å¯ä»¥è¿‡æ»¤æŸä¸€åˆ—ä¸­åŒ…å«ä»€ä¹ˆ ï¼Œè¿‡æ»¤æŸä¸€åˆ—ä¸­ä»¥xxxå¼€å¤´æˆ–ç»“å°¾

  ```bash
  awk -F':' '$4 ~ /^[01]/'
  âœ  ~ awk -F':' '$4 ~ /^[01]/''{print $1,$3}' passwd
  root 0
  bin 1
  sync 5
  shutdown 6
  ```

  > awk ä¸­ï¼Œé€šè¿‡ $3 ~
  >
  > * ~ è¡¨ç¤ºåŒ…å«çš„æ„æ€ï¼Œ`$1 ~ /root/` è¡¨ç¤ºç¬¬ä¸€åˆ—ä¸­åŒ…å« root
  > * !~ è¡¨ç¤ºä¸åŒ…å«

**å°ç»“**

* å–è¡Œ: `NR==1`ã€`NR>=1`ã€`$3 >=1000`ã€`$3 ~ /root/`
* å–åˆ—ï¼š`$1`ã€`$NF`ã€`$(NF-1)`

### 2.5 ç»Ÿè®¡ä¸è®¡ç®—

#### ç»Ÿè®¡æ¬¡æ•°

* ä»…ä»…éœ€è¦ç»Ÿè®¡å‡ºç°äº†å¤šå°‘æ¬¡ï¼Œå‡ºç°äº†å¤šå°‘ä¸ªï¼Œå¯ä»¥ä½¿ç”¨ wc -l æ–¹å¼



```bash
âœ  ~ awk '{i=i+1} END {print i}' /etc/passwd
24
```

> END{} å†…å®¹ä¼šåœ¨ awk è¯»å–å®Œæ–‡ä»¶çš„æ—¶å€™æ‰§è¡Œ
>
> END{} ä¸€èˆ¬ç”¨äºè¾“å‡ºæ‰§è¡Œç»“æœ

#### è®¡ç®—æ€»å’Œ

```bash
âœ  ~ cat num.txt
1
2
3
4
5
6
7
8
9
10
âœ  ~ awk '{i=i+$1} END {print i}' num.txt
55
```

### æ€»ç»“

- [ ] awk å–è¡Œåˆ—
- [ ] awk è¿›è¡Œå¯¹åˆ—çš„æ¯”è¾ƒå¤§å°
- [ ] awk è¿›è¡Œå¯¹åˆ—è¿‡æ»¤
- [ ] awk è®¡ç®—ã€æ±‚å’Œ



---

![image-20240721161727452](http://cdn.zhouchuang.site/img/20240721161728.png)

> seqï¼šè¾“å‡ºæ•°å­—åºåˆ—

```bash
seq 10 

seq 5 10

seq 1 2 10
```
